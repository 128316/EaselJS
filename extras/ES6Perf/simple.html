<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ES5 Transpiled Simple Performance Tests</title>
    <script src="../../node_modules/createjs/node_modules/benchmark/node_modules/lodash/lodash.min.js"></script>
    <script src="../../node_modules/createjs/node_modules/benchmark/benchmark.js"></script>
    <script src="./assets/simple-transpiled.js"></script>
    <script src="./assets/simple-es6.js"></script>
    <script src="./assets/simple-es5.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      // create the suites
      var classSuite = new Benchmark.Suite;
      var methodSuite = new Benchmark.Suite;

      function cycle (evt) {
        console.log(evt.target.toString());
      }

      function complete () {
        for (var i = 0, l = this.length; i < l; i+=3) {
          var testA = this[i];
          var testB = this[i+1];
          var testC = this[i+2];
          var countA = testA.count;
          var countB = testB.count;
          var countC = testC.count;
          var max = Math.max(countA, countB, countC);
          var median = Math.max(Math.min(countA, countB), Math.min(Math.max(countA, countB), countC));
          var compareAB = testA.compare(testB);
          var compareAC = testA.compare(testC);
          var compareBC = testB.compare(testC);
          var fastest = "Indeterminate";
          if (compareAB == 1 && compareAC == 1) { fastest = "ES5"; }
          else if (compareAB == -1 && compareBC == 1) { fastest = "Transpiled"; }
          else if (compareAC == -1 && compareBC == -1) { fastest = "ES6"; }
          console.log("-- " + testA.name + " --");
          var perc = (((max - min) / min) * 100).toFixed(2) + "%";
          var times = (max / min).toFixed(2) + "x";
          console.log("fastest: " + fastest + " by " + perc + " (" + times + ")");
        }
        this.reset();
      }

      // create the class instantiation tests
      classSuite.add("es5: instantiating simple", function (C) { new C(); }.bind(classSuite, BaseSimple))
                .add("transpiled: instantiating simple", function (C) { new C(); }.bind(classSuite, TranspiledSimple))
                .add("es5: instantiating extended", function (C) { new C(); }.bind(classSuite, BaseExtended))
                .add("transpiled: instantiating extended", function (C) { new C(); }.bind(classSuite, TranspiledExtended))
                .on("cycle", cycle)
                .on("complete", complete);

      // create the method call tests
      let es5Simple = new ES5Simple();
      let transpiledSimple = new TranspiledSimple();
      let es6Simple = new ES6Simple();
      let es5Extended = new ES5Extended();
      let transpiledExtended = new TranspiledExtended();
      let es6Extended = new ES6Extended();
      methodSuite.add("es5: proto", function () { es5Simple.inheritTest(); })
                 .add("transpiled: proto", function () { transpiledSimple.inheritTest(); })
                 .add("es6: proto", function () { es6Simple.inheritTest(); })
                 .add("es5: inherit", function () { es5Extended.inheritTest(); })
                 .add("transpiled: inherit", function () { transpiledExtended.inheritTest(); })
                 .add("es6: inherit", function () { es6Extended.inheritTest(); })
                 .add("es5: extended", function () { es5Extended.extendTest(); })
                 .add("transpiled: extended", function () { transpiledExtended.extendTest(); })
                 .add("es6: extended", function () { es6Extended.extendTest(); })
                 .add("es5: super", function () { es5Extended.superTest(); })
                 .add("transpiled: super", function () { transpiledExtended.superTest(); })
                 .add("es6: super", function () { es6Extended.superTest(); })
                 .on("cycle", cycle)
                 .on("complete", complete);

      // type `classSuite.run()` or `methodSuite.run()` in console to initiate testing.
    </script>
  </body>
</html>
