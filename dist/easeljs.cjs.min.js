/*!
* @license easeljs
* Visit http://createjs.com for documentation, updates and examples.
*
* Copyright (c) 2011-2016 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var asyncGenerator=function(){function t(t){this.value=t}function e(e){function i(t,e){return new Promise(function(i,a){var o={key:t,arg:e,resolve:i,reject:a,next:null};s?s=s.next=o:(n=s=o,r(t,e))})}function r(i,n){try{var s=e[i](n),o=s.value;o instanceof t?Promise.resolve(o.value).then(function(t){r("next",t)},function(t){r("throw",t)}):a(s.done?"return":"normal",s.value)}catch(t){a("throw",t)}}function a(t,e){switch(t){case"return":n.resolve({value:e,done:!0});break;case"throw":n.reject(e);break;default:n.resolve({value:e,done:!1})}n=n.next,n?r(n.key,n.arg):s=null}var n,s;this._invoke=i,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),get$1=function t(e,i,r){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,i);if(void 0===a){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,i,r)}if("value"in a)return a.value;var s=a.get;if(void 0!==s)return s.call(r)},inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},set$1=function t(e,i,r,a){var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var s=Object.getPrototypeOf(e);null!==s&&t(s,i,r,a)}else if("value"in n&&n.writable)n.value=r;else{var o=n.set;void 0!==o&&o.call(a,r)}return r},Event=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];classCallCheck(this,t),this.type=e,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=i,this.cancelable=r,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}return createClass(t,[{key:"preventDefault",value:function(){this.defaultPrevented=this.cancelable}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"remove",value:function(){this.removed=!0}},{key:"clone",value:function(){var e=new t(this.type,this.bubbles,this.cancelable);for(var i in this)this.hasOwnProperty(i)&&(e[i]=this[i]);return e}},{key:"set",value:function(t){for(var e in t)this[e]=t[e];return this}},{key:"toString",value:function(){return"[Event (type="+this.type+")]"}}]),t}(),EventDispatcher=function(){function t(){classCallCheck(this,t),this._listeners=null,this._captureListeners=null}return createClass(t,null,[{key:"initialize",value:function(e){var i=t.prototype;e.addEventListener=i.addEventListener,e.on=i.on,e.removeEventListener=e.off=i.removeEventListener,e.removeAllEventListeners=i.removeAllEventListeners,e.hasEventListener=i.hasEventListener,e.dispatchEvent=i.dispatchEvent,e._dispatchEvent=i._dispatchEvent,e.willTrigger=i.willTrigger}}]),createClass(t,[{key:"addEventListener",value:function(t,e,i){var r=void 0;r=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var a=r[t];return a&&this.removeEventListener(t,e,i),a=r[t],a?a.push(e):r[t]=[e],e}},{key:"on",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,a),r&&t.remove()},n)}},{key:"removeEventListener",value:function(t,e,i){var r=i?this._captureListeners:this._listeners;if(r){var a=r[t];if(a)for(var n=a.length,s=0;s<n;s++)if(a[s]==e){1==n?delete r[t]:a.splice(s,1);break}}}},{key:"off",value:function(t,e,i){this.removeEventListener(t,e,i)}},{key:"removeAllEventListeners",value:function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null}},{key:"dispatchEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof t){var r=this._listeners;if(!(e||r&&r[t]))return!0;t=new Event(t,e,i)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var a=this,n=void 0,s=[a];a.parent;)s.push(a=a.parent);var o=s.length;for(n=o-1;n>=0&&!t.propagationStopped;n--)s[n]._dispatchEvent(t,1+(0==n));for(n=1;n<o&&!t.propagationStopped;n++)s[n]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return!t.defaultPrevented}},{key:"hasEventListener",value:function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])}},{key:"willTrigger",value:function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1}},{key:"toString",value:function(){return"[EventDispatcher]"}},{key:"_dispatchEvent",value:function(t,e){var i=1==e?this._captureListeners:this._listeners,r=void 0;if(t&&i){var a=i[t.type];if(!a||!(r=a.length))return;try{t.currentTarget=this}catch(t){}try{t.eventPhase=e}catch(t){}t.removed=!1,a=a.slice();for(var n=0;n<r&&!t.immediatePropagationStopped;n++){var s=a[n];s.handleEvent?s.handleEvent(t):s(t),t.removed&&(this.off(t.type,s,1==e),t.removed=!1)}}}}]),t}(),_nextID=0,UID=function(){function t(){throw classCallCheck(this,t),"UID cannot be instantiated"}return createClass(t,null,[{key:"get",value:function(){return t._nextID++}},{key:"_nextID",get:function(){return _nextID},set:function(t){_nextID=t}}]),t}(),Point=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;classCallCheck(this,t),this.setValues(e,i)}return createClass(t,[{key:"setValues",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"toString",value:function(){return"[Point (x="+this.x+" y="+this.y+")]"}}]),t}(),Matrix2D=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;classCallCheck(this,t),this.setValues(e,i,r,a,n,s)}return createClass(t,[{key:"setValues",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=a,this.ty=n,this}},{key:"append",value:function(t,e,i,r,a,n){var s=this.a,o=this.b,h=this.c,l=this.d;return 1==t&&0==e&&0==i&&1==r||(this.a=s*t+h*e,this.b=o*t+l*e,this.c=s*i+h*r,this.d=o*i+l*r),this.tx=s*a+h*n+this.tx,this.ty=o*a+l*n+this.ty,this}},{key:"prepend",value:function(t,e,i,r,a,n){var s=this.a,o=this.c,h=this.tx;return this.a=t*s+i*this.b,this.b=e*s+r*this.b,this.c=t*o+i*this.d,this.d=e*o+r*this.d,this.tx=t*h+i*this.ty+a,this.ty=e*h+r*this.ty+n,this}},{key:"appendMatrix",value:function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)}},{key:"prependMatrix",value:function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)}},{key:"appendTransform",value:function(e,i,r,a,n,s,o,h,l){var u=void 0,c=void 0,v=void 0;return n%360?(u=n*t.DEG_TO_RAD,c=Math.cos(u),v=Math.sin(u)):(c=1,v=0),s||o?(s*=t.DEG_TO_RAD,o*=t.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(s),Math.cos(s),e,i),this.append(c*r,v*r,-v*a,c*a,0,0)):this.append(c*r,v*r,-v*a,c*a,e,i),(h||l)&&(this.tx-=h*this.a+l*this.c,this.ty-=h*this.b+l*this.d),this}},{key:"prependTransform",value:function(e,i,r,a,n,s,o,h,l){var u=void 0,c=void 0,v=void 0;return n%360?(u=n*t.DEG_TO_RAD,c=Math.cos(u),v=Math.sin(u)):(c=1,v=0),(h||l)&&(this.tx-=h,this.ty-=l),s||o?(s*=t.DEG_TO_RAD,o*=t.DEG_TO_RAD,this.prepend(c*r,v*r,-v*a,c*a,0,0),this.prepend(Math.cos(o),Math.sin(o),-Math.sin(s),Math.cos(s),e,i)):this.prepend(c*r,v*r,-v*a,c*a,e,i),this}},{key:"rotate",value:function(e){e*=t.DEG_TO_RAD;var i=Math.cos(e),r=Math.sin(e),a=this.a,n=this.b;return this.a=a*i+this.c*r,this.b=n*i+this.d*r,this.c=-a*r+this.c*i,this.d=-n*r+this.d*i,this}},{key:"skew",value:function(e,i){return e*=t.DEG_TO_RAD,i*=t.DEG_TO_RAD,this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0),this}},{key:"scale",value:function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}},{key:"translate",value:function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this}},{key:"identity",value:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this}},{key:"invert",value:function(){var t=this.a,e=this.b,i=this.c,r=this.d,a=this.tx,n=t*r-e*i;return this.a=r/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-r*a)/n,this.ty=-(t*this.ty-e*a)/n,this}},{key:"isIdentity",value:function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d}},{key:"equals",value:function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d}},{key:"transformPoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Point;return i.x=t*this.a+e*this.c+this.tx,i.y=t*this.b+e*this.d+this.ty,i}},{key:"decompose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d),r=Math.atan2(this.b,this.a),a=Math.abs(1-i/r);return a<1e-5?(e.rotation=r/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=i/t.DEG_TO_RAD,e.skewY=r/t.DEG_TO_RAD),e}},{key:"copy",value:function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)}},{key:"clone",value:function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)}},{key:"toString",value:function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"}}]),t}();Matrix2D.DEG_TO_RAD=Math.PI/180,Matrix2D.identity=new Matrix2D;var DisplayProps=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments[2],a=arguments[3],n=arguments[4];classCallCheck(this,t),this.setValues(e,i,r,a,n)}return createClass(t,[{key:"setValues",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments[2],r=arguments[3],a=arguments[4];return this.visible=t,this.alpha=e,this.shadow=i,this.compositeOperation=r,this.matrix=a||this.matrix&&this.matrix.identity()||new Matrix2D,this}},{key:"append",value:function(t,e,i,r,a){return this.alpha*=e,this.shadow=i||this.shadow,this.compositeOperation=r||this.compositeOperation,this.visible=this.visible&&t,a&&this.matrix.appendMatrix(a),this}},{key:"prepend",value:function(t,e,i,r,a){return this.alpha*=e,this.shadow=this.shadow||i,this.compositeOperation=this.compositeOperation||r,this.visible=this.visible&&t,a&&this.matrix.prependMatrix(a),this}},{key:"identity",value:function(){return this.visible=!0,this.alpha=1,this.shadow=this.compositeOperation=null,this.matrix.identity(),this}},{key:"clone",value:function(){return new t(this.alpha,this.shadow,this.compositeOperation,this.visible,this.matrix.clone())}}]),t}(),Rectangle=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;classCallCheck(this,t),this.setValues(e,i,r,a)}return createClass(t,[{key:"setValues",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x=t,this.y=e,this.width=i,this.height=r,this}},{key:"extend",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t+i>this.x+this.width&&(this.width=t+i-this.x),e+r>this.y+this.height&&(this.height=e+r-this.y),t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),this}},{key:"pad",value:function(t,e,i,r){return this.x-=e,this.y-=t,this.width+=e+r,this.height+=t+i,this}},{key:"copy",value:function(t){return this.setValues(t.x,t.y,t.width,t.height)}},{key:"contains",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t>=this.x&&t+i<=this.x+this.width&&e>=this.y&&e+r<=this.y+this.height}},{key:"union",value:function(t){return this.clone().extend(t.x,t.y,t.width,t.height)}},{key:"intersection",value:function(e){var i=e.x,r=e.y,a=i+e.width,n=r+e.height;return this.x>i&&(i=this.x),this.y>r&&(r=this.y),this.x+this.width<a&&(a=this.x+this.width),this.y+this.height<n&&(n=this.y+this.height),a<=i||n<=r?null:new t(i,r,a-i,n-r)}},{key:"intersects",value:function(t){return t.x<=this.x+this.width&&this.x<=t.x+t.width&&t.y<=this.y+this.height&&this.y<=t.y+t.height}},{key:"isEmpty",value:function(){return this.width<=0||this.height<=0}},{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"toString",value:function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"}}]),t}(),Filter=function(){function t(){classCallCheck(this,t),this.VTX_SHADER_BODY=null,this.FRAG_SHADER_BODY=null}return createClass(t,[{key:"getBounds",value:function(t){return t}},{key:"shaderParamSetup",value:function(t,e,i){}},{key:"applyFilter",value:function(t,e,i,r,a,n,s,o){n=n||t,null==s&&(s=e),null==o&&(o=i);try{var h=t.getImageData(e,i,r,a);if(this._applyFilter(h))return n.putImageData(h,s,o),!0}catch(t){}return!1}},{key:"toString",value:function(){return"["+this.constructor.name+"]"}},{key:"clone",value:function(){return new t}},{key:"_applyFilter",value:function(t){return!0}}]),t}(),BitmapCache=function(t){function e(){classCallCheck(this,e);var t=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.width=void 0,t.height=void 0,t.x=void 0,t.y=void 0,t.scale=1,t.offX=0,t.offY=0,t.cacheID=0,t._filterOffX=0,t._filterOffY=0,t._cacheDataURLID=0,t._cacheDataURL=null,t._drawWidth=0,t._drawHeight=0,t}return inherits(e,t),createClass(e,[{key:"define",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments[6];if(!t)throw"No symbol to cache";this._options=s,this.target=t,this.width=r>=1?r:1,this.height=a>=1?a:1,this.x=e,this.y=i,this.scale=n,this.update()}},{key:"update",value:function(t){if(!this.target)throw"define() must be called before update()";var i=e.getFilterBounds(this.target),r=this.target.cacheCanvas;this._drawWidth=Math.ceil(this.width*this.scale)+i.width,this._drawHeight=Math.ceil(this.height*this.scale)+i.height,r&&this._drawWidth==r.width&&this._drawHeight==r.height||this._updateSurface(),this._filterOffX=i.x,this._filterOffY=i.y,this.offX=this.x*this.scale+this._filterOffX,this.offY=this.y*this.scale+this._filterOffY,this._drawToCache(t),this.cacheID=this.cacheID?this.cacheID+1:1}},{key:"release",value:function(){this.target=this.target.cacheCanvas=null,this.cacheID=this._cacheDataURLID=this._cacheDataURL=void 0,this.width=this.height=this.x=this.y=this.offX=this.offY=0,this.scale=1}},{key:"getCacheDataURL",value:function(){var t=this.target&&this.target.cacheCanvas;return t?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURLID=this.cacheID,this._cacheDataURL=t.toDataURL?t.toDataURL():null),this._cacheDataURL):null}},{key:"draw",value:function(t){return!!this.target&&(t.drawImage(this.target.cacheCanvas,this.x+this._filterOffX,this.y+this._filterOffY,this.width,this.height),!0)}},{key:"_updateSurface",value:function(){var t=this.target.cacheCanvas;t||(t=this.target.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),t.width=this._drawWidth,t.height=this._drawHeight}},{key:"_drawToCache",value:function(t){var e=this.target,i=e.cacheCanvas,r=i.getContext("2d");t||r.clearRect(0,0,this._drawWidth+1,this._drawHeight+1),r.save(),r.globalCompositeOperation=t,r.setTransform(this.scale,0,0,this.scale,-this.offX,-this.offY),e.draw(r,!0),r.restore(),e.filters&&e.filters.length&&this._applyFilters(e)}},{key:"_applyFilters",value:function(){for(var t=this.target.cacheCanvas,e=this.target.filters,i=t.width,r=t.height,a=t.getContext("2d").getImageData(0,0,i,r),n=e.length,s=0;s<n;s++)e[s]._applyFilter(a);t.getContext("2d").putImageData(a,0,0)}}],[{key:"getFilterBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rectangle,i=t.filters,r=i&&i.length;if(r>0)return e;for(var a=0;a<r;a++){var n=i[a];if(n&&n.getBounds){var s=n.getBounds();s&&(0==a?e.setValues(s.x,s.y,s.width,s.height):e.extend(s.x,s.y,s.width,s.height))}}return e}}]),e}(Filter),DisplayObject=function(t){function e(){classCallCheck(this,e);var t=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.alpha=1,t.cacheCanvas=null,t.bitmapCache=null,t.id=UID.get(),t.mouseEnabled=!0,t.tickEnabled=!0,t.name=null,t.parent=null,t.regX=0,t.regY=0,t.rotation=0,t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.shadow=null,t.visible=!0,t.x=0,t.y=0,t.transformMatrix=null,t.compositeOperation=null,t.snapToPixel=!0,t.filters=null,t.mask=null,t.hitArea=null,t.cursor=null,t._props=new DisplayProps,t._rectangle=new Rectangle,t._bounds=null,t}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.drawCache(t,e)}},{key:"drawCache",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.bitmapCache;return!(!i||e)&&i.draw(t)}},{key:"updateContext",value:function(t){var i=this,r=i.mask,a=i._props.matrix;r&&r.graphics&&!r.graphics.isEmpty()&&(r.getMatrix(a),t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty),r.graphics.drawAsPath(t),t.clip(),a.invert(),t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty)),this.getMatrix(a);var n=a.tx,s=a.ty;e._snapToPixelEnabled&&i.snapToPixel&&(n=n+(n<0?-.5:.5)|0,s=s+(s<0?-.5:.5)|0),t.transform(a.a,a.b,a.c,a.d,n,s),t.globalAlpha*=i.alpha,i.compositeOperation&&(t.globalCompositeOperation=i.compositeOperation),i.shadow&&this._applyShadow(t,i.shadow)}},{key:"cache",value:function(t,e,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.bitmapCache||(this.bitmapCache=new BitmapCache),this.bitmapCache.define(this,t,e,i,r,a,n)}},{key:"updateCache",value:function(t){if(!this.bitmapCache)throw"cache() must be called before updateCache()";this.bitmapCache.update(t)}},{key:"uncache",value:function(){this.bitmapCache&&(this.bitmapCache.release(),this.bitmapCache=void 0)}},{key:"getCacheDataURL",value:function(){return this.bitmapCache?this.bitmapCache.getDataURL():null}},{key:"localToGlobal",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Point;return this.getConcatenatedMatrix(this._props.matrix).transformPoint(t,e,i)}},{key:"globalToLocal",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Point;return this.getConcatenatedMatrix(this._props.matrix).invert().transformPoint(t,e,i)}},{key:"localToLocal",value:function(t,e,i,r){return r=this.localToGlobal(t,e,r),i.globalToLocal(r.x,r.y,r)}},{key:"setTransform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.x=t,this.y=e,this.scaleX=i,this.scaleY=r,this.rotation=a,this.skewX=n,this.skewY=s,this.regX=o,this.regY=h,this}},{key:"getMatrix",value:function(t){var e=this,i=t&&t.identity()||new Matrix2D;return e.transformMatrix?i.copy(e.transformMatrix):i.appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY)}},{key:"getConcatenatedMatrix",value:function(t){for(var e=this,i=this.getMatrix(t);e=e.parent;)i.prependMatrix(e.getMatrix(e._props.matrix));return i}},{key:"getConcatenatedDisplayProps",value:function(t){t=t?t.identity():new DisplayProps;var e=this,i=e.getMatrix(t.matrix);do t.prepend(e.visible,e.alpha,e.shadow,e.compositeOperation),e!=this&&i.prependMatrix(e.getMatrix(e._props.matrix));while(e=e.parent);return t}},{key:"hitTest",value:function(t,i){var r=e._hitTestContext;r.setTransform(1,0,0,1,-t,-i),this.draw(r);var a=this._testHit(r);return r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,2,2),a}},{key:"set",value:function(t){for(var e in t)this[e]=t[e];return this}},{key:"getBounds",value:function(){if(this._bounds)return this._rectangle.copy(this._bounds);var t=this.cacheCanvas;if(t){var e=this._cacheScale;return this._rectangle.setValues(this._cacheOffsetX,this._cacheOffsetY,t.width/e,t.height/e)}return null}},{key:"getTransformedBounds",value:function(){return this._getBounds()}},{key:"setBounds",value:function(t,e,i,r){null==t&&(this._bounds=t),this._bounds=(this._bounds||new Rectangle).setValues(t,e,i,r)}},{key:"clone",value:function(){return this._cloneProps(new e)}},{key:"toString",value:function(){return"["+this.constructor.name+(this.name?" (name="+this.name+")":"")+"]"}},{key:"_cloneProps",value:function(t){return t.alpha=this.alpha,t.mouseEnabled=this.mouseEnabled,t.tickEnabled=this.tickEnabled,t.name=this.name,t.regX=this.regX,t.regY=this.regY,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.shadow=this.shadow,t.skewX=this.skewX,t.skewY=this.skewY,t.visible=this.visible,t.x=this.x,t.y=this.y,t.compositeOperation=this.compositeOperation,t.snapToPixel=this.snapToPixel,t.filters=null==this.filters?null:this.filters.slice(0),t.mask=this.mask,t.hitArea=this.hitArea,t.cursor=this.cursor,t._bounds=this._bounds,t}},{key:"_applyShadow",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Shadow.identity;e=e,t.shadowColor=e.color,t.shadowOffsetX=e.offsetX,t.shadowOffsetY=e.offsetY,t.shadowBlur=e.blur}},{key:"_tick",value:function(t){var e=this._listeners;e&&e.tick&&(t.target=null,t.propagationStopped=t.immediatePropagationStopped=!1,this.dispatchEvent(t))}},{key:"_testHit",value:function(t){try{return t.getImageData(0,0,1,1).data[3]>1}catch(t){if(!e.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images.";return!1}}},{key:"_getBounds",value:function(t,e){return this._transformBounds(this.getBounds(),t,e)}},{key:"_transformBounds",value:function(t,e,i){if(!t)return t;var r=t.x,a=t.y,n=t.width,s=t.height,o=this._props.matrix;o=i?o.identity():this.getMatrix(o),(r||a)&&o.appendTransform(0,0,1,1,0,0,0,-r,-a),e&&o.prependMatrix(e);var h=n*o.a,l=n*o.b,u=s*o.c,c=s*o.d,v=o.tx,d=o.ty,_=v,f=v,p=d,g=d;return(r=h+v)<_?_=r:r>f&&(f=r),(r=h+u+v)<_?_=r:r>f&&(f=r),(r=u+v)<_?_=r:r>f&&(f=r),(a=l+d)<p?p=a:a>g&&(g=a),(a=l+c+d)<p?p=a:a>g&&(g=a),(a=c+d)<p?p=a:a>g&&(g=a),t.setValues(_,p,f-_,g-p)}},{key:"_hasMouseEventListener",value:function(){for(var t=e._MOUSE_EVENTS,i=0,r=t.length;i<r;i++)if(this.hasEventListener(t[i]))return!0;return!!this.cursor}},{key:"stage",get:function(){for(var t=this;t.parent;)t=t.parent;return/^\[Stage(GL)?(\s\(name=\w+\))?\]$/.test(t.toString())?t:null}}]),e}(EventDispatcher),canvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");canvas.getContext&&(DisplayObject._hitTestCanvas=canvas,DisplayObject._hitTestContext=canvas.getContext("2d"),canvas.width=canvas.height=1),DisplayObject._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],DisplayObject.suppressCrossDomainErrors=!1,DisplayObject.snapToPixelEnabled=!1;var Container=function(t){function e(){classCallCheck(this,e);var t=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.children=[],t.mouseChildren=!0,t.tickChildren=!0,t}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){var t=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)}},{key:"draw",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i))return!0;for(var r=this.children.slice(),a=0,n=r.length;a<n;a++){var s=r[a];s.isVisible()&&(t.save(),s.updateContext(t),s.draw(t),t.restore())}return!0}},{key:"addChild",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(0==r)return null;var a=e[0];if(r>1){for(var n=0;n<r;n++)a=this.addChild(e[n]);return a}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.push(a),a.dispatchEvent("added"),a}},{key:"addChildAt",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.pop(),a=e.length;if(r<0||r>this.children.length)return e[a-2];if(a>2){for(var n=0;n<a-1;n++)this.addChildAt(e[n],r++);return e[a-2]}var s=e[0];return s.parent&&s.parent.removeChild(s),s.parent=this,this.children.splice(r++,0,s),s.dispatchEvent("added"),s}},{key:"removeChild",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(r>1){for(var a=!0,n=0;n<r;n++)a=a&&this.removeChild(e[n]);return a}return this.removeChildAt(this.children.indexOf(e[0]))}},{key:"removeChildAt",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(r>1){e.sort(function(t,e){return e-t});for(var a=!0,n=0;n<r;n++)a=a&&this.removeChildAt(e[n]);return a}var s=e[0];if(s<0||s>this.children.length-1)return!1;var o=this.children[s];return o&&(o.parent=null),this.children.splice(s,1),o.dispatchEvent("removed"),!0}},{key:"removeAllChildren",value:function(){for(var t=this.children;t.length;)this.removeChildAt(0)}},{key:"getChildAt",value:function(t){return this.children[t]}},{key:"getChildByName",value:function(t){for(var e=this.children,i=e.length,r=0;r<i;r++)if(e[r].name==t)return e[r];return null}},{key:"sortChildren",value:function(t){this.children.sort(t)}},{key:"getChildIndex",value:function(t){return this.children.indexOf(t)}},{key:"swapChildrenAt",value:function(t,e){var i=this.children,r=i[t],a=i[e];r&&a&&(i[t]=a,i[e]=r)}},{key:"swapChildren",value:function(t,e){for(var i=this.children,r=i.length,a=void 0,n=void 0,s=0;s<r&&(i[s]==t&&(a=s),i[s]==e&&(n=s),null==a||null==n);s++);s!=r&&(i[a]=e,i[n]=t)}},{key:"setChildIndex",value:function(t,e){var i=this.children,r=i.length;if(!(t.parent!=this||e<0||e>=r)){for(var a=0;a<r&&i[a]!=t;a++);a!=r&&a!=e&&(i.splice(a,1),i.splice(e,0,t))}}},{key:"contains",value:function(t){for(;t;){if(t==this)return!0;t=t.parent}return!1}},{key:"hitTest",value:function(t,e){return null!=this.getObjectUnderPoint(t,e)}},{key:"getObjectsUnderPoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],a=this.localToGlobal(t,e);return this._getObjectsUnderPoint(a.x,a.y,r,i>0,1==i),r}},{key:"getObjectUnderPoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.localToGlobal(t,e);return this._getObjectsUnderPoint(r.x,r.y,null,i>0,1==i)}},{key:"getBounds",value:function(){return this._getBounds(null,!0)}},{key:"getTransformedBounds",value:function(){return this._getBounds()}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this._cloneProps(new e);return t&&this._cloneChildren(i),i}},{key:"_tick",value:function(t){if(this.tickChildren)for(var i=this.children.length-1;i>=0;i--){var r=this.children[i];r.tickEnabled&&r._tick&&r._tick(t)}get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_tick",this).call(this,t)}},{key:"_cloneChildren",value:function(t){t.children.length&&t.removeAllChildren();for(var e=t.children,i=this.children.length,r=0;r<i;r++){var a=this.children[r].clone(!0);a.parent=t,e.push(a)}}},{key:"_getObjectsUnderPoint",value:function(t,i,r,a,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!s&&!this._testMask(this,t,i))return null;var o=void 0,h=DisplayObject._hitTestContext;n=n||a&&this._hasMouseEventListener();for(var l=this.children,u=l.length,c=u-1;c>=0;c--){var v=l[c],d=v.hitArea;if(v.visible&&(d||v.isVisible())&&(!a||v.mouseEnabled)&&(d||this._testMask(v,t,i)))if(!d&&v instanceof e){var _=v._getObjectsUnderPoint(t,i,r,a,n,s+1);if(!r&&_)return a&&!this.mouseChildren?this:_}else{if(a&&!n&&!v._hasMouseEventListener())continue;var f=v.getConcatenatedDisplayProps(v._props);if(o=f.matrix,d&&(o.appendMatrix(d.getMatrix(d._props.matrix)),f.alpha=d.alpha),h.globalAlpha=f.alpha,h.setTransform(o.a,o.b,o.c,o.d,o.tx-t,o.ty-i),(d||v).draw(h),!this._testHit(h))continue;if(h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,2,2),!r)return a&&!this.mouseChildren?this:v;r.push(v)}}return null}},{key:"_testMask",value:function(t,e,i){var r=t.mask;if(!r||!r.graphics||r.graphics.isEmpty())return!0;var a=this._props.matrix,n=t.parent;a=n?n.getConcatenatedMatrix(a):a.identity(),a=r.getMatrix(r._props.matrix).prependMatrix(a);var s=DisplayObject._hitTestContext;return s.setTransform(a.a,a.b,a.c,a.d,a.tx-e,a.ty-i),r.graphics.drawAsPath(s),s.fillStyle="#000",s.fill(),!!this._testHit(s)&&(s.setTransform(1,0,0,1,0,0),
s.clearRect(0,0,2,2),!0)}},{key:"_getBounds",value:function(t,i){var r=get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBounds",this).call(this);if(r)return this._transformBounds(r,t,i);var a=this._props.matrix;a=i?a.identity():this.getMatrix(a),t&&a.prependMatrix(t);for(var n=this.children.length,s=null,o=0;o<n;o++){var h=this.children[o];h.visible&&(r=h._getBounds(a))&&(s?s.extend(r.x,r.y,r.width,r.height):s=r.clone())}return s}},{key:"numChildren",get:function(){return this.children.length}}]),e}(DisplayObject),Bitmap=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return"string"==typeof t?(i.image=document.createElement("img"),i.image.src=t):i.image=t,i.sourceRect=null,i}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){var t=this.image,e=this.cacheCanvas||t&&(t.naturalWidth||t.getContext||t.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)}},{key:"draw",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i)||!this.image)return!0;var r=this.image,a=this.sourceRect;if(a){var n=a.x,s=a.y,o=n+a.width,h=s+a.height,l=0,u=0,c=r.width,v=r.height;n<0&&(l-=n,n=0),o>c&&(o=c),s<0&&(u-=s,s=0),h>v&&(h=v),t.drawImage(r,n,s,o-n,h-s,l,u,o-n,h-s)}else t.drawImage(r,0,0);return!0}},{key:"getBounds",value:function(){var t=get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBounds",this).call(this);if(t)return t;var i=this.image,r=this.sourceRect||i,a=i&&(i.naturalWidth||i.getContext||i.readyState>=2);return a?this._rectangle.setValues(0,0,r.width,r.height):null}},{key:"clone",value:function(){var t=new e(this.image);return this.sourceRect&&(t.sourceRect=this.sourceRect.clone()),this._cloneProps(t),t}}]),e}(DisplayObject),Sprite=function(t){function e(t,i){classCallCheck(this,e);var r=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.currentFrame=0,r.currentAnimation=null,r.paused=!0,r.spriteSheet=t,r.currentAnimationFrame=0,r.framerate=0,r._animation=null,r._currentFrame=null,r._skipAdvance=!1,null!=i&&r.gotoAndPlay(i),r}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){var t=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)}},{key:"draw",value:function(t,i){if(get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i))return!0;this._normalizeFrame();var r=this.spriteSheet.getFrame(0|this._currentFrame);if(!r)return!1;var a=r.rect;return a.width&&a.height&&t.drawImage(r.image,a.x,a.y,a.width,a.height,-r.regX,-r.regY,a.width,a.height),!0}},{key:"play",value:function(){this.paused=!1}},{key:"stop",value:function(){this.paused=!0}},{key:"gotoAndPlay",value:function(t){this.paused=!1,this._skipAdvance=!0,this._goto(t)}},{key:"gotoAndStop",value:function(t){this.paused=!0,this._goto(t)}},{key:"advance",value:function(t){var e=this.framerate||this.spriteSheet.framerate,i=e&&null!=t?t/(1e3/e):1;this._normalizeFrame(i)}},{key:"getBounds",value:function(){return get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBounds",this).call(this)||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)}},{key:"clone",value:function(){return this._cloneProps(new e(this.spriteSheet))}},{key:"_cloneProps",value:function(t){return get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_cloneProps",this).call(this,t),t.currentFrame=this.currentFrame,t.currentAnimation=this.currentAnimation,t.paused=this.paused,t.currentAnimationFrame=this.currentAnimationFrame,t.framerate=this.framerate,t._animation=this._animation,t._currentFrame=this._currentFrame,t._skipAdvance=this._skipAdvance,t}},{key:"_tick",value:function(t){this.paused||(this._skipAdvance||this.advance(t&&t.delta),this._skipAdvance=!1),get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_tick",this).call(this,t)}},{key:"_normalizeFrame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._animation,i=this.paused,r=this._currentFrame;if(e){var a=e.speed||1,n=this.currentAnimationFrame,s=e.frames.length;if(n+t*a>=s){var o=e.next;if(this._dispatchAnimationEnd(e,r,i,o,s-1))return;if(o)return this._goto(o,t-(s-n)/a);this.paused=!0,n=e.frames.length-1}else n+=t*a;this.currentAnimationFrame=n,this._currentFrame=e.frames[0|n]}else{r=this._currentFrame+=t;var h=this.spriteSheet.getNumFrames();if(r>=h&&h>0&&!this._dispatchAnimationEnd(e,r,i,h-1)&&(this._currentFrame-=h)>=h)return this._normalizeFrame()}r=0|this._currentFrame,this.currentFrame!=r&&(this.currentFrame=r,this.dispatchEvent("change"))}},{key:"_dispatchAnimationEnd",value:function(t,e,i,r,a){var n=t?t.name:null;if(this.hasEventListener("animationend")){var s=new Event("animationend");s.name=n,s.next=r,this.dispatchEvent(s)}var o=this._animation!=t||this._currentFrame!=e;return o||i||!this.paused||(this.currentAnimationFrame=a,o=!0),o}},{key:"_goto",value:function(t,e){if(this.currentAnimationFrame=0,isNaN(t)){var i=this.spriteSheet.getAnimation(t);i&&(this._animation=i,this.currentAnimation=t,this._normalizeFrame(e))}else this.currentAnimation=this._animation=null,this._currentFrame=t,this._normalizeFrame()}}]),e}(DisplayObject),_maxPoolSize=100,_spritePool=[],BitmapText=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;classCallCheck(this,e);var r=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.text=t,r.spriteSheet=i,r.lineHeight=0,r.letterSpacing=0,r.spaceWidth=0,r._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0},r}return inherits(e,t),createClass(e,[{key:"draw",value:function(t,i){get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i)}},{key:"getBounds",value:function(){return this._updateText(),get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBounds",this).call(this)}},{key:"isVisible",value:function(){var t=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!==this.scaleX&&0!==this.scaleY&&t)}},{key:"clone",value:function(){return this._cloneProps(new e(this.text,this.spriteSheet))}},{key:"addChild",value:function(){}},{key:"addChildAt",value:function(){}},{key:"removeChild",value:function(){}},{key:"removeChildAt",value:function(){}},{key:"removeAllChildren",value:function(){}},{key:"_cloneProps",value:function(t){return get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_cloneProps",this).call(this,t),t.lineHeight=this.lineHeight,t.letterSpacing=this.letterSpacing,t.spaceWidth=this.spaceWidth,t}},{key:"_getFrameIndex",value:function(t,e){var i=void 0,r=e.getAnimation(t);return r||(t!=(i=t.toUpperCase())||t!=(i=t.toLowerCase())||(i=null),i&&(r=e.getAnimation(i))),r&&r.frames[0]}},{key:"_getFrame",value:function(t,e){var i=this._getFrameIndex(t,e);return null==i?i:e.getFrame(i)}},{key:"_getLineHeight",value:function(t){var e=this._getFrame("1",t)||this._getFrame("T",t)||this._getFrame("L",t)||t.getFrame(0);return e?e.rect.height:1}},{key:"_getSpaceWidth",value:function(t){var e=this._getFrame("1",t)||this._getFrame("l",t)||this._getFrame("e",t)||this._getFrame("a",t)||t.getFrame(0);return e?e.rect.width:1}},{key:"_tick",value:function(t){var i=this.stage;i&&i.on("drawstart",this._updateText,this,!0),get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_tick",this).call(this,t)}},{key:"_updateText",value:function(){var t=0,i=0,r=this._oldProps,a=!1,n=this.spaceWidth,s=this.lineHeight,o=this.spriteSheet,h=e._spritePool,l=this.children,u=0,c=l.length,v=void 0;for(var d in r)r[d]!=this[d]&&(r[d]=this[d],a=!0);if(a){var _=!!this._getFrame(" ",o);_||n||(n=this._getSpaceWidth(o)),s||(s=this._getLineHeight(o));for(var f=0,p=this.text.length;f<p;f++){var g=this.text.charAt(f);if(" "!=g||_)if("\n"!=g&&"\r"!=g){var m=this._getFrameIndex(g,o);null!=m&&(u<c?v=l[u]:(l.push(v=h.length?h.pop():new Sprite),v.parent=this,c++),v.spriteSheet=o,v.gotoAndStop(m),v.x=t,v.y=i,u++,t+=v.getBounds().width+this.letterSpacing)}else"\r"==g&&"\n"==this.text.charAt(f+1)&&f++,t=0,i+=s;else t+=n}for(;c>u;)h.push(v=l.pop()),v.parent=null,c--;h.length>e.maxPoolSize&&(h.length=e.maxPoolSize)}}}],[{key:"maxPoolSize",get:function(){return _maxPoolSize},set:function(t){_maxPoolSize=t}},{key:"_spritePool",get:function(){return _spritePool}}]),e}(Container),DOMElement=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));"string"==typeof t&&(t=document.getElementById(t)),i.mouseEnabled=!1;var r=t.style;return r.position="absolute",r.transformOrigin=r.WebkitTransformOrigin=r.msTransformOrigin=r.MozTransformOrigin=r.OTransformOrigin="0% 0%",i.htmlElement=t,i._oldProps=null,i}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){return null!=this.htmlElement}},{key:"draw",value:function(t,e){return!0}},{key:"cache",value:function(){}},{key:"uncache",value:function(){}},{key:"updateCache",value:function(){}},{key:"hitTest",value:function(){}},{key:"localToGlobal",value:function(){}},{key:"globalToLocal",value:function(){}},{key:"localToLocal",value:function(){}},{key:"clone",value:function(){throw"DOMElement cannot be cloned."}},{key:"_tick",value:function(t){var i=this.stage;i&&i.on("drawend",this._handleDrawEnd,this,!0),get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_tick",this).call(this,t)}},{key:"_handleDrawEnd",value:function(t){var e=this.htmlElement;if(e){var i=e.style,r=this.getConcatenatedDisplayProps(this._props),a=r.matrix,n=r.visible?"visible":"hidden";if(n!=i.visibility&&(i.visibility=n),r.visible){var s=this._oldProps,o=s&&s.matrix,h=1e4;if(!o||!o.equals(a)){var l="matrix("+(a.a*h|0)/h+","+(a.b*h|0)/h+","+(a.c*h|0)/h+","+(a.d*h|0)/h+","+(a.tx+.5|0);i.transform=i.WebkitTransform=i.OTransform=i.msTransform=l+","+(a.ty+.5|0)+")",i.MozTransform=l+"px,"+(a.ty+.5|0)+"px)",s||(s=this._oldProps=new DisplayProps((!0),NaN)),s.matrix.copy(a)}s.alpha!=r.alpha&&(i.opacity=""+(r.alpha*h|0)/h,s.alpha=r.alpha)}}}}]),e}(DisplayObject),Graphics=function(){function t(){classCallCheck(this,t),this.command=null,this._stroke=null,this._strokeStyle=null,this._oldStrokeStyle=null,this._strokeDash=null,this._oldStrokeDash=null,this._strokeIgnoreScale=!1,this._fill=null,this._instructions=[],this._commitIndex=0,this._activeInstructions=[],this._dirty=!1,this._storeIndex=0,this.curveTo=this.quadraticCurveTo,this.drawRect=this.rect,this.mt=this.moveTo,this.lt=this.lineTo,this.at=this.arcTo,this.bt=this.bezierCurveTo,this.qt=this.quadraticCurveTo,this.a=this.arc,this.r=this.rect,this.cp=this.closePath,this.c=this.clear,this.f=this.beginFill,this.lf=this.beginLinearGradientFill,this.rf=this.beginRadialGradientFill,this.bf=this.beginBitmapFill,this.ef=this.endFill,this.ss=this.setStrokeStyle,this.sd=this.setStrokeDash,this.s=this.beginStroke,this.ls=this.beginLinearGradientStroke,this.rs=this.beginRadialGradientStroke,this.bs=this.beginBitmapStroke,this.es=this.endStroke,this.dr=this.drawRect,this.rr=this.drawRoundRect,this.rc=this.drawRoundRectComplex,this.dc=this.drawCircle,this.de=this.drawEllipse,this.dp=this.drawPolyStar,this.p=this.decodePath,this.clear()}return createClass(t,[{key:"isEmpty",value:function(){return!(this._instructions.length||this._activeInstructions.length)}},{key:"draw",value:function(t,e){this._updateInstructions();for(var i=this._instructions,r=i.length,a=this._storeIndex;a<r;a++)i[a].exec(t,e)}},{key:"drawAsPath",value:function(t){this._updateInstructions();for(var e=void 0,i=this._instructions,r=i.length,a=this._storeIndex;a<r;a++)(e=i[a]).path!==!1&&e.exec(t)}},{key:"moveTo",value:function(t,e){return this.append(new MoveTo(t,e),!0)}},{key:"lineTo",value:function(t,e){return this.append(new LineTo(t,e))}},{key:"arcTo",value:function(t,e,i,r,a){return this.append(new ArcTo(t,e,i,r,a))}},{key:"arc",value:function(t,e,i,r,a,n){return this.append(new Arc(t,e,i,r,a,n))}},{key:"quadraticCurveTo",value:function(t,e,i,r){return this.append(new QuadraticCurveTo(t,e,i,r))}},{key:"bezierCurveTo",value:function(t,e,i,r,a,n){return this.append(new BezierCurveTo(t,e,i,r,a,n))}},{key:"rect",value:function(t,e,i,r){return this.append(new Rect(t,e,i,r))}},{key:"closePath",value:function(){return this._activeInstructions.length?this.append(new ClosePath):this}},{key:"clear",value:function(){return this._instructions.length=this._activeInstructions.length=this._commitIndex=0,this._strokeStyle=this._oldStrokeStyle=this._stroke=this._fill=this._strokeDash=this._oldStrokeDash=null,this._dirty=this._strokeIgnoreScale=!1,this}},{key:"beginFill",value:function(t){return this._setFill(t?new Fill(t):null)}},{key:"beginLinearGradientFill",value:function(t,e,i,r,a,n){return this._setFill((new Fill).linearGradient(t,e,i,r,a,n))}},{key:"beginRadialGradientFill",value:function(t,e,i,r,a,n,s,o){return this._setFill((new Fill).radialGradient(t,e,i,r,a,n,s,o))}},{key:"beginBitmapFill",value:function(t,e,i){return this._setFill(new Fill(null,i).bitmap(t,e))}},{key:"endFill",value:function(){return this.beginFill()}},{key:"setStrokeStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this._updateInstructions(!0),this._strokeStyle=this.command=new StrokeStyle(t,e,i,r,a),this._stroke&&(this._stroke.ignoreScale=a),this._strokeIgnoreScale=a,this}},{key:"setStrokeDash",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._updateInstructions(!0),this._strokeDash=this.command=new StrokeDash(t,e),this}},{key:"beginStroke",value:function(t){return this._setStroke(t?new Stroke(t):null)}},{key:"beginLinearGradientStroke",value:function(t,e,i,r,a,n){return this._setStroke((new Stroke).linearGradient(t,e,i,r,a,n))}},{key:"beginRadialGradientStroke",value:function(t,e,i,r,a,n,s,o){return this._setStroke((new Stroke).radialGradient(t,e,i,r,a,n,s,o))}},{key:"beginBitmapStroke",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"repeat";return this._setStroke((new Stroke).bitmap(t,e))}},{key:"endStroke",value:function(){return this.beginStroke()}},{key:"drawRoundRect",value:function(t,e,i,r,a){return this.drawRoundRectComplex(t,e,i,r,a,a,a,a)}},{key:"drawRoundRectComplex",value:function(t,e,i,r,a,n,s,o){return this.append(new RoundRect(t,e,i,r,a,n,s,o))}},{key:"drawCircle",value:function(t,e,i){return this.append(new Circle(t,e,i))}},{key:"drawEllipse",value:function(t,e,i,r){return this.append(new Ellipse(t,e,i,r))}},{key:"drawPolyStar",value:function(t,e,i,r,a,n){return this.append(new PolyStar(t,e,i,r,a,n))}},{key:"append",value:function(t,e){return this._activeInstructions.push(t),this.command=t,e||(this._dirty=!0),this}},{key:"decodePath",value:function(e){for(var i=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],r=[2,2,4,6,0],a=0,n=e.length,s=[],o=0,h=0,l=t.BASE_64;a<n;){var u=e.charAt(a),c=l[u],v=c>>3,d=i[v];if(!d||3&c)throw"bad path data (@"+a+"):c";var _=r[v];v||(o=h=0),s.length=0,a++;for(var f=(c>>2&1)+2,p=0;p<_;p++){var g=l[e.charAt(a)],m=g>>5?-1:1;g=(31&g)<<6|l[e.charAt(a+1)],3==f&&(g=g<<6|l[e.charAt(a+2)]),g=m*g/10,p%2?o=g+=o:h=g+=h,s[p]=g,a+=f}d.apply(this,s)}return this}},{key:"store",value:function(){return this._updateInstructions(!0),this._storeIndex=this._instructions.length,this}},{key:"unstore",value:function(){return this._storeIndex=0,this}},{key:"clone",value:function(){var e=new t;return e.command=this.command,e._stroke=this._stroke,e._strokeStyle=this._strokeStyle,e._strokeDash=this._strokeDash,e._strokeIgnoreScale=this._strokeIgnoreScale,e._fill=this._fill,e._instructions=this._instructions.slice(),e._commitIndex=this._commitIndex,e._activeInstructions=this._activeInstructions.slice(),e._dirty=this._dirty,e._storeIndex=this._storeIndex,e}},{key:"toString",value:function(){return"[Graphics]"}},{key:"_updateInstructions",value:function(e){var i=this._instructions,r=this._activeInstructions,a=this._commitIndex;if(this._dirty&&r.length){i.length=a,i.push(t.beginCmd);var n=r.length,s=i.length;i.length=s+n;for(var o=0;o<n;o++)i[o+s]=r[o];this._fill&&i.push(this._fill),this._stroke&&(this._strokeDash!==this._oldStrokeDash&&(this._oldStrokeDash=this._strokeDash,i.push(this._strokeDash)),this._strokeStyle!==this._oldStrokeStyle&&(this._oldStrokeStyle=this._strokeStyle,i.push(this._strokeStyle)),i.push(this._stroke)),this._dirty=!1}e&&(r.length=0,this._commitIndex=i.length)}},{key:"_setFill",value:function(t){return this._updateInstructions(!0),this.command=this._fill=t,this}},{key:"_setStroke",value:function(t){return this._updateInstructions(!0),(this.command=this._stroke=t)&&(t.ignoreScale=this._strokeIgnoreScale),this}},{key:"instructions",get:function(){return this._updateInstructions(),this._instructions}}],[{key:"getRGB",value:function(t,e,i,r){return null!=t&&null==i&&(r=e,i=255&t,e=t>>8&255,t=t>>16&255),null==r?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+","+r+")"}},{key:"getHSL",value:function(t,e,i,r){return null==r?"hsl("+t%360+","+e+"%,"+i+"%)":"hsl("+t%360+","+e+"%,"+i+"%,"+r+")"}}]),t}(),LineTo=function(){function t(e,i){classCallCheck(this,t),this.x=e,this.y=i}return createClass(t,[{key:"exec",value:function(t){t.lineTo(this.x,this.y)}}]),t}(),MoveTo=function(){function t(e,i){classCallCheck(this,t),this.x=e,this.y=i}return createClass(t,[{key:"exec",value:function(t){t.moveTo(this.x,this.y)}}]),t}(),ArcTo=function(){function t(e,i,r,a,n){classCallCheck(this,t),this.x1=e,this.y1=i,this.x2=r,this.y2=a,this.radius=n}return createClass(t,[{key:"exec",value:function(t){t.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)}}]),t}(),Arc=function(){function t(e,i,r,a,n,s){classCallCheck(this,t),this.x=e,this.y=i,this.radius=r,this.startAngle=a,this.endAngle=n,this.anticlockwise=!!s}return createClass(t,[{key:"exec",value:function(t){t.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)}}]),t}(),QuadraticCurveTo=function(){function t(e,i,r,a){classCallCheck(this,t),this.cpx=e,this.cpy=i,this.x=r,this.y=a}return createClass(t,[{key:"exec",value:function(t){t.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)}}]),t}(),BezierCurveTo=function(){function t(e,i,r,a,n,s){classCallCheck(this,t),this.cp1x=e,this.cp1y=i,this.cp2x=r,this.cp2y=a,this.x=n,this.y=s}return createClass(t,[{key:"exec",value:function(t){t.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)}}]),t}(),Rect=function(){function t(e,i,r,a){classCallCheck(this,t),this.x=e,this.y=i,this.w=r,this.h=a}return createClass(t,[{key:"exec",value:function(t){t.rect(this.x,this.y,this.w,this.h)}}]),t}(),ClosePath=function(){function t(){classCallCheck(this,t)}return createClass(t,[{key:"exec",value:function(t){t.closePath()}}]),t}(),BeginPath=function(){function t(){classCallCheck(this,t)}return createClass(t,[{key:"exec",value:function(t){t.beginPath()}}]),t}(),Fill=function(){function t(e,i){classCallCheck(this,t),this.style=e,this.matrix=i,this.path=!1}return createClass(t,[{key:"exec",value:function(t){if(this.style){t.fillStyle=this.style;var e=this.matrix;e&&(t.save(),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),t.fill(),e&&t.restore()}}},{key:"linearGradient",value:function(t,e,i,r,a,n){for(var s=this.style=Graphics._ctx.createLinearGradient(i,r,a,n),o=t.length,h=0;h<o;h++)s.addColorStop(e[h],t[h]);return s.props={colors:t,ratios:e,x0:i,y0:r,x1:a,y1:n,type:"linear"},this}},{key:"radialGradient",value:function(t,e,i,r,a,n,s,o){for(var h=this.style=Graphics._ctx.createRadialGradient(i,r,a,n,s,o),l=t.length,u=0;u<l;u++)h.addColorStop(e[u],t[u]);return h.props={colors:t,ratios:e,x0:i,y0:r,r0:a,x1:n,y1:s,r1:o,type:"radial"},this}},{key:"bitmap",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t.naturalWidth||t.getContext||t.readyState>=2){var i=this.style=Graphics._ctx.createPattern(t,e);i.props={image:t,repetition:e,type:"bitmap"}}return this}}]),t}(),Stroke=function(){function t(e,i){classCallCheck(this,t),this.style=e,this.ignoreScale=i,this.path=!1}return createClass(t,[{key:"exec",value:function(t){this.style&&(t.strokeStyle=this.style,this.ignoreScale&&(t.save(),t.setTransform(1,0,0,1,0,0)),t.stroke(),this.ignoreScale&&t.restore())}},{key:"linearGradient",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];Fill.prototype.linearGradient.apply(this,e)}},{key:"radialGradient",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];Fill.prototype.radialGradient.apply(this,e)}},{key:"bitmap",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];Fill.prototype.bitmap.apply(this,e)}}]),t}(),StrokeStyle=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"butt",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"miter",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];classCallCheck(this,t),this.width=e,this.caps=i,this.joints=r,this.miterLimit=a,this.ignoreScale=n,this.path=!1}return createClass(t,[{key:"exec",value:function(t){t.lineWidth=this.width,t.lineCap=isNaN(this.caps)?this.caps:Graphics.STROKE_CAPS_MAP[this.caps],t.lineJoin=isNaN(this.joints)?this.joints:Graphics.STROKE_JOINTS_MAP[this.joints],t.miterLimit=this.miterLimit,t.ignoreScale=this.ignoreScale}}]),t}(),StrokeDash=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.EMPTY_SEGMENTS,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;classCallCheck(this,t),this.segments=e,this.offset=i}return createClass(t,[{key:"exec",value:function(t){t.setLineDash&&(t.setLineDash(this.segments),t.lineDashOffset=this.offset)}}],[{key:"EMPTY_SEGMENTS",get:function(){return _EMPTY_SEGMENTS}}]),t}(),RoundRect=function(){function t(e,i,r,a,n,s,o,h){classCallCheck(this,t),this.x=e,this.y=i,this.w=r,this.h=a,this.radiusTL=n,this.radiusTR=s,this.radiusBR=o,this.radiusBL=h}return createClass(t,[{key:"exec",value:function(t){var e=(h<l?h:l)/2,i=0,r=0,a=0,n=0,s=this.x,o=this.y,h=this.w,l=this.h,u=this.radiusTL,c=this.radiusTR,v=this.radiusBR,d=this.radiusBL;u<0&&(u*=i=-1),u>e&&(u=e),c<0&&(c*=r=-1),c>e&&(c=e),v<0&&(v*=a=-1),v>e&&(v=e),d<0&&(d*=n=-1),d>e&&(d=e),t.moveTo(s+h-c,o),t.arcTo(s+h+c*r,o-c*r,s+h,o+c,c),t.lineTo(s+h,o+l-v),t.arcTo(s+h+v*a,o+l+v*a,s+h-v,o+l,v),t.lineTo(s+d,o+l),t.arcTo(s-d*n,o+l+d*n,s,o+l-d,d),t.lineTo(s,o+u),t.arcTo(s-u*i,o-u*i,s+u,o,u),t.closePath()}}]),t}(),Circle=function(){function t(e,i,r){classCallCheck(this,t),this.x=e,this.y=i,this.radius=r}return createClass(t,[{key:"exec",value:function(t){t.arc(this.x,this.y,this.radius,0,2*Math.PI)}}]),t}(),Ellipse=function(){function t(e,i,r,a){classCallCheck(this,t),this.x=e,this.y=i,this.w=r,this.h=a}return createClass(t,[{key:"exec",value:function(t){var e=this.x,i=this.y,r=this.w,a=this.h,n=.5522848,s=r/2*n,o=a/2*n,h=e+r,l=i+a,u=e+r/2,c=i+a/2;t.moveTo(e,c),t.bezierCurveTo(e,c-o,u-s,i,u,i),t.bezierCurveTo(u+s,i,h,c-o,h,c),t.bezierCurveTo(h,c+o,u+s,l,u,l),t.bezierCurveTo(u-s,l,e,c+o,e,c)}}]),t}(),PolyStar=function(){function t(e,i,r,a){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;classCallCheck(this,t),this.x=e,this.y=i,this.radius=r,this.sides=a,this.pointSize=n,this.angle=s}return createClass(t,[{key:"exec",value:function(t){var e=this.x,i=this.y,r=this.radius,a=this.angle/180*Math.PI,n=this.sides,s=1-this.pointSize,o=Math.PI/n;t.moveTo(e+Math.cos(a)*r,i+Math.sin(a)*r);for(var h=0;h<n;h++)a+=o,1!=s&&t.lineTo(e+Math.cos(a)*r*s,i+Math.sin(a)*r*s),a+=o,t.lineTo(e+Math.cos(a)*r,i+Math.sin(a)*r);t.closePath()}}]),t}(),canvas$1=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");canvas$1.getContext&&(Graphics._ctx=canvas$1.getContext("2d"),canvas$1.width=canvas$1.height=1),Graphics.beginCmd=new BeginPath,Graphics.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},Graphics.STROKE_CAPS_MAP=["butt","round","square"],Graphics.STROKE_JOINTS_MAP=["miter","round","bevel"],Graphics.EMPTY_SEGMENTS=[];var MovieClip=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.INDEPENDENT,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;classCallCheck(this,e);var n=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return!e.inited&&e.init(),n.mode=t,n.startPosition=i,n.loop=r,n.currentFrame=0,n.timeline=new Timeline(null,a,{paused:!0,position:i,useTicks:!0}),n.paused=!1,n.actionsEnabled=!0,n.autoReset=!0,n.frameBounds=n.frameBounds||null,n.framerate=null,n._synchOffset=0,n._prevPos=-1,n._prevPosition=0,n._t=0,n._managed={},n}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)}},{key:"draw",value:function(t,i){return!!this.cacheDraw(t,i)||(this._updateTimeline(),get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i),!0)}},{key:"play",value:function(){this.paused=!1}},{key:"stop",value:function(){this.paused=!0}},{key:"gotoAndPlay",value:function(t){this.paused=!1,this._goto(t)}},{key:"gotoAndStop",value:function(t){this.paused=!0,this._goto(t)}},{key:"advance",value:function(t){var i=e.INDEPENDENT;if(this.mode==i){for(var r=this,a=r.framerate;(r=r.parent)&&null==a;)r.mode==i&&(a=r._framerate);this._framerate=a;var n=null!=a&&a!=-1&&null!=t?t/(1e3/a)+this._t:1,s=0|n;for(this._t=n-s;!this.paused&&s--;)this._prevPosition=this._prevPos<0?0:this._prevPosition+1,this._updateTimeline()}}},{key:"clone",value:function(){throw"MovieClip cannot be cloned."}},{key:"_tick",value:function(t){this.advance(t&&t.delta),get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_tick",this).call(this,t)}},{key:"_goto",value:function(t){var e=this.timeline.resolve(t);null!=e&&(this._prevPos==-1&&(this._prevPos=NaN),this._prevPosition=e,this._t=0,this._updateTimeline())}},{key:"_reset",value:function(){this._prevPos=-1,this._t=this.currentFrame=0,this.paused=!1}},{key:"_updateTimeline",value:function(){var t=this.timeline,i=this.mode!=e.INDEPENDENT;t.loop=null==this.loop||this.loop;var r=i?this.startPosition+(this.mode==e.SINGLE_FRAME?0:this._synchOffset):this._prevPos<0?0:this._prevPosition,a=i||!this.actionsEnabled?Tween.NONE:null;if(this.currentFrame=t._calcPosition(r),t.setPosition(r,a),this._prevPosition=t._prevPosition,this._prevPos!=t._prevPos){this.currentFrame=this._prevPos=t._prevPos;for(var n in this._managed)this._managed[n]=1;var s=(t._tweens,!0),o=!1,h=void 0;try{for(var l,u=t._tweens[Symbol.iterator]();!(s=(l=u.next()).done);s=!0){var c=l.value,v=c._target;if(v!=this&&!c.passive){var d=c._stepPosition;v instanceof createjs.DisplayObject?this._addManagedChild(v,d):this._setState(v.state,d)}}}catch(t){o=!0,h=t}finally{try{!s&&u.return&&u.return()}finally{if(o)throw h}}for(var _=this.children,f=_.length-1;f>=0;f--){var p=_[f].id;1==this._managed[p]&&(this.removeChildAt(f),delete this._managed[p])}}}},{key:"_setState",value:function(t,e){if(t)for(var i=t.length-1;i>=0;i--){var r=t[i],a=r.t,n=r.p;for(var s in n)a[s]=n[s];this._addManagedChild(a,e)}}},{key:"_addManagedChild",value:function(t,i){t._off||(this.addChildAt(t,0),t instanceof e&&(t._synchOffset=i,t.mode==e.INDEPENDENT&&t.autoReset&&!this._managed[t.id]&&t._reset()),this._managed[t.id]=2)}},{key:"_getBounds",value:function(t,i){var r=this.getBounds();return r||(this._updateTimeline(),this.frameBounds&&(r=this._rectangle.copy(this.frameBounds[this.currentFrame]))),r?this._transformBounds(r,t,i):get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_getBounds",this).call(this,t,i)}},{key:"labels",get:function(){return this.timeline.getLabels()}},{key:"currentLabel",get:function(){return this._updateTimeline(),this.timeline.getCurrentLabel()}},{key:"duration",get:function(){return this.timeline.duration}},{key:"totalFrames",get:function(){return this.duration}}],[{key:"init",value:function(){e.inited||(MovieClipPlugin.install(),e.inited=!0)}}]),e}(Container);MovieClip.INDEPENDENT="independent",MovieClip.SINGLE_FRAME="single",MovieClip.SYNCHED="synched",MovieClip.inited=!1;var MovieClipPlugin=function(){function t(){throw classCallCheck(this,t),"MovieClipPlugin cannot be instantiated."}return createClass(t,null,[{key:"install",value:function(){Tween.installPlugin(t,["startPosition"])}},{key:"init",value:function(t,e,i){return i}},{key:"tween",value:function(t,e,i,r,a,n,s,o){return t.target instanceof MovieClip?1==n?a[e]:r[e]:i}}]),t}();MovieClipPlugin.priority=100;var Shadow$1=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"black",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;classCallCheck(this,t),this.color=e,this.offsetX=i,this.offsetY=r,this.blur=a}return createClass(t,[{key:"toString",value:function(){return"[Shadow]"}},{key:"clone",value:function(){return new t(this.color,this.offsetX,this.offsetY,this.blur)}}]),t}();Shadow$1.identity=new Shadow$1("transparent");var Shape=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Graphics;classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.graphics=t,i}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){var t=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)}},{key:"draw",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i)||(this.graphics.draw(t,this),!0)}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=t&&this.graphics?this.graphics.clone():this.graphics;return this._cloneProps(new e(i))}}]),e}(DisplayObject),SpriteSheet=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.complete=!0,i.framerate=0,i._animations=null,i._frames=null,i._images=null,i._data=null,i._loadCount=0,i._frameHeight=0,i._frameWidth=0,i._numFrames=0,i._regX=0,i._regY=0,i._spacing=0,i._margin=0,i._parseData(t),i}return inherits(e,t),createClass(e,[{key:"getNumFrames",value:function(t){if(null==t)return this._frames?this._frames.length:this._numFrames||0;var e=this._data[t];return null==e?0:e.frames.length}},{key:"getAnimation",value:function(t){return this._data[t]}},{key:"getFrame",value:function(t){var e=void 0;return this._frames&&(e=this._frames[t])?e:null}},{key:"getFrameBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rectangle,i=this.getFrame(t);return i?e.setValues(-i.regX,-i.regY,i.rect.width,i.rect.height):null}},{key:"toString",value:function(){return"[SpriteSheet]"}},{key:"clone",value:function(){
throw"SpriteSheet cannot be cloned."}},{key:"_parseData",value:function(t){var e=this;if(null!=t){if(this.framerate=t.framerate||0,t.images){var i=!0,r=!1,a=void 0;try{for(var n,s=t.images[Symbol.iterator]();!(i=(n=s.next()).done);i=!0){var o=n.value,h=this._images=[];if("string"==typeof o){var l=o;o=document.createElement("img"),o.src=l}h.push(o),o.getContext||o.naturalWidth||(this._loadCount++,this.complete=!1,o.onload=function(){return e._handleImadeLoad(src)},o.onerror=function(){return e._handleImageError(src)})}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}}if(null!=t.frames)if(Array.isArray(t.frames)){this._frames=[];var u=!0,c=!1,v=void 0;try{for(var d,_=t.frames[Symbol.iterator]();!(u=(d=_.next()).done);u=!0){var f=d.value;this._frames.push({image:this._images[f[4]?f[4]:0],rect:new Rectangle(f[0],f[1],f[2],f[3]),regX:f[5]||0,regY:f[6]||0})}}catch(t){c=!0,v=t}finally{try{!u&&_.return&&_.return()}finally{if(c)throw v}}}else{var p=t.frames;this._frameWidth=p.width,this._frameHeight=p.height,this._regX=p.regX||0,this._regY=p.regY||0,this._spacing=p.spacing||0,this._margin=p.margin||0,this._numFrames=p.count,0==this._loadCount&&this._calculateFrames()}if(this._animations=[],null!=t.animations){this._data={};var g=t.animations;for(var m in g){var y={name:m},x=g[m],b=void 0;if("number"==typeof x)b=y.frames=[x];else if(Array.isArray(x))if(1==x.length)y.frames=[x[0]];else{y.speed=x[3],y.next=x[2],b=y.frames=[];for(var w=x[0];w<=x[1];w++)b.push(w)}else{y.speed=x.speed,y.next=x.next;var k=x.frames;b=y.frames="number"==typeof k?[k]:k.slice(0)}y.next!==!0&&void 0!==y.next||(y.next=m),(y.next===!1||b.length<2&&y.next==m)&&(y.next=null),y.speed||(y.speed=1),this._animations.push(m),this._data[m]=y}}}}},{key:"_handleImageLoad",value:function(t){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))}},{key:"_handleImageError",value:function(t){var e=new Event("error");e.src=t,this.dispatchEvent(e),0==--this._loadCount&&this.dispatchEvent("complete")}},{key:"_calculateFrames",value:function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];var t=this._numFrames||1e5,e=0,i=this._frameWidth,r=this._frameHeight,a=this._spacing,n=this._margin;t:for(var s=0,o=this._images,h=o.length;s<h;s++)for(var l=o[s],u=l.width,c=l.height,v=n;v<=c-n-r;){for(var d=n;d<=u-n-i;){if(e>=t)break t;e++,this._frames.push({image:l,rect:new Rectangle(d,v,i,r),regX:this._regX,regY:this._regY}),d+=i+a}v+=r+a}this._numFrames=e}}},{key:"animations",get:function(){return this._animations.slice()}}]),e}(EventDispatcher),MouseEvent=function(t){function e(t,i,r,a,n,s,o,h,l,u,c){classCallCheck(this,e);var v=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r));return v.stageX=a,v.stageY=n,v.rawX=null==l?a:l,v.rawY=null==u?n:u,v.nativeEvent=s,v.pointerID=o,v.primary=!!h,v.relatedTarget=c,v}return inherits(e,t),createClass(e,[{key:"clone",value:function(){return new e(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)}},{key:"toString",value:function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"}},{key:"localX",get:function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x}},{key:"localY",get:function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y}},{key:"isTouch",get:function(){return this.pointerID!==-1}}]),e}(Event),Stage=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.autoClear=!0,i.canvas="string"==typeof t?document.getElementById(t):t,i.mouseX=0,i.mouseY=0,i.drawRect=null,i.snapToPixelEnabled=!1,i.mouseInBounds=!1,i.tickOnUpdate=!0,i.mouseMoveOutside=!1,i.preventSelection=!0,i._pointerData={},i._pointerCount=0,i._primaryPointerID=null,i._mouseOverIntervalID=null,i._nextStage=null,i._prevStage=null,i.enableDOMEvents(!0),i}return inherits(e,t),createClass(e,[{key:"update",value:function(t){if(this.canvas&&(this.tickOnUpdate&&this.tick(t),this.dispatchEvent("drawstart",!1,!0)!==!1)){DisplayObject._snapToPixelEnabled=this.snapToPixelEnabled;var e=this.drawRect,i=this.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),this.autoClear&&(e?i.clearRect(e.x,e.y,e.width,e.height):i.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)),i.save(),this.drawRect&&(i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()),this.updateContext(i),this.draw(i,!1),i.restore(),this.dispatchEvent("drawend")}}},{key:"tick",value:function(t){if(this.tickEnabled&&this.dispatchEvent("tickstart",!1,!0)!==!1){var e=new Event("tick");if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);this._tick(e),this.dispatchEvent("tickend")}}},{key:"handleEvent",value:function(t){"tick"==t.type&&this.update(t)}},{key:"clear",value:function(){if(this.canvas){var t=this.canvas.getContext("2d");t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}}},{key:"toDataURL",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",i=void 0,r=this.canvas.getContext("2d"),a=this.canvas.width,n=this.canvas.height;if(t){i=r.getImageData(0,0,a,n);var s=r.globalCompositeOperation;r.globalCompositeOperation="destination-over",r.fillStyle=t,r.fillRect(0,0,a,n)}var o=this.canvas.toDataURL(e);return t&&(r.putImageData(i,0,0),r.globalCompositeOperation=s),o}},{key:"enableMouseOver",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==e&&this._testMouseOver(!0)),e<=0||(this._mouseOverIntervalID=setInterval(function(){return t._testMouseOver()},1e3/Math.min(50,e)))}},{key:"enableDOMEvents",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this._eventListeners;if(!e&&i){for(var r in i){var a=i[r];a.t.removeEventListener(r,a.f,!1)}this._eventListeners=null}else if(e&&!i&&this.canvas){var n=window.addEventListener?window:document;i=this._eventListeners={mouseup:{t:n,f:function(e){return t._handleMouseUp(e)}},mousemove:{t:n,f:function(e){return t._handleMouseMove(e)}},dblclick:{t:this.canvas,f:function(e){return t._handleDoubleClick(e)}},mousedown:{t:this.canvas,f:function(e){return t._handleMouseDown(e)}}};for(var s in i){var o=i[s];o.t.addEventListener(s,o.f,!1)}}}},{key:"clone",value:function(){throw"Stage cannot be cloned."}},{key:"_getElementRect",value:function(t){var e=void 0;try{e=t.getBoundingClientRect()}catch(i){e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}var i=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),r=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),a=window.getComputedStyle?getComputedStyle(t,null):t.currentStyle,n=parseInt(a.paddingLeft)+parseInt(a.borderLeftWidth),s=parseInt(a.paddingTop)+parseInt(a.borderTopWidth),o=parseInt(a.paddingRight)+parseInt(a.borderRightWidth),h=parseInt(a.paddingBottom)+parseInt(a.borderBottomWidth);return{left:e.left+i+n,right:e.right+i-o,top:e.top+r+s,bottom:e.bottom+r-h}}},{key:"_getPointerData",value:function(t){var e=this._pointerData[t];return e||(e=this._pointerData[t]={x:0,y:0}),e}},{key:"_handleMouseMove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;this._handlePointerMove(-1,t,t.pageX,t.pageY)}},{key:"_handlePointerMove",value:function(t,e,i,r,a){if((!this._prevStage||void 0!==a)&&this.canvas){var n=this._nextStage,s=this._getPointerData(t),o=s.inBounds;this._updatePointerPosition(t,e,i,r),(o||s.inBounds||this.mouseMoveOutside)&&(t===-1&&s.inBounds==!o&&this._dispatchMouseEvent(this,o?"mouseleave":"mouseenter",!1,t,s,e),this._dispatchMouseEvent(this,"stagemousemove",!1,t,s,e),this._dispatchMouseEvent(s.target,"pressmove",!0,t,s,e)),n&&n._handlePointerMove(t,e,i,r,null)}}},{key:"_updatePointerPosition",value:function(t,e,i,r){var a=this._getElementRect(this.canvas);i-=a.left,r-=a.top;var n=this.canvas.width,s=this.canvas.height;i/=(a.right-a.left)/n,r/=(a.bottom-a.top)/s;var o=this._getPointerData(t);(o.inBounds=i>=0&&r>=0&&i<=n-1&&r<=s-1)?(o.x=i,o.y=r):this.mouseMoveOutside&&(o.x=i<0?0:i>n-1?n-1:i,o.y=r<0?0:r>s-1?s-1:r),o.posEvtObj=e,o.rawX=i,o.rawY=r,t!==this._primaryPointerID&&t!==-1||(this.mouseX=o.x,this.mouseY=o.y,this.mouseInBounds=o.inBounds)}},{key:"_handleMouseUp",value:function(t){this._handlePointerUp(-1,t,!1)}},{key:"_handlePointerUp",value:function(t,e,i,r){var a=this._nextStage,n=this._getPointerData(t);if(!this._prevStage||void 0!==r){var s=null,o=n.target;r||!o&&!a||(s=this._getObjectsUnderPoint(n.x,n.y,null,!0)),n.down&&(this._dispatchMouseEvent(this,"stagemouseup",!1,t,n,e,s),n.down=!1),s==o&&this._dispatchMouseEvent(o,"click",!0,t,n,e),this._dispatchMouseEvent(o,"pressup",!0,t,n,e),i?(t==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[t]):n.target=null,a&&a._handlePointerUp(t,e,i,r||s&&this)}}},{key:"_handleMouseDown",value:function(t){this._handlePointerDown(-1,t,t.pageX,t.pageY)}},{key:"_handlePointerDown",value:function(t,e,i,r,a){this.preventSelection&&e.preventDefault(),null!=this._primaryPointerID&&t!==-1||(this._primaryPointerID=t),null!=r&&this._updatePointerPosition(t,e,i,r);var n=null,s=this._nextStage,o=this._getPointerData(t);a||(n=o.target=this._getObjectsUnderPoint(o.x,o.y,null,!0)),o.inBounds&&(this._dispatchMouseEvent(this,"stagemousedown",!1,t,o,e,n),o.down=!0),this._dispatchMouseEvent(n,"mousedown",!0,t,o,e),s&&s._handlePointerDown(t,e,i,r,a||n&&this)}},{key:"_testMouseOver",value:function(t,e,i){if(!this._prevStage||void 0!==e){var r=this._nextStage;if(!this._mouseOverIntervalID)return void(r&&r._testMouseOver(t,e,i));var a=this._getPointerData(-1);if(a&&(t||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var n=a.posEvtObj,s=i||n&&n.target==this.canvas,o=null,h=-1,l="";!e&&(t||this.mouseInBounds&&s)&&(o=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);for(var u=this._mouseOverTarget||[],c=u[u.length-1],v=this._mouseOverTarget=[],d=o;d;)v.unshift(d),l||(l=d.cursor),d=d.parent;this.canvas.style.cursor=l,!e&&i&&(i.canvas.style.cursor=l);for(var _=0,f=v.length;_<f&&v[_]==u[_];_++)h=_;c!=o&&this._dispatchMouseEvent(c,"mouseout",!0,-1,a,n,o);for(var p=u.length-1;p>h;p--)this._dispatchMouseEvent(u[p],"rollout",!1,-1,a,n,o);for(var g=v.length-1;g>h;g--)this._dispatchMouseEvent(v[g],"rollover",!1,-1,a,n,c);c!=o&&this._dispatchMouseEvent(o,"mouseover",!0,-1,a,n,c),r&&r._testMouseOver(t,e||o&&this,i||s&&this)}}}},{key:"_handleDoubleClick",value:function(t,e){var i=null,r=this._nextStage,a=this._getPointerData(-1);e||(i=this._getObjectsUnderPoint(a.x,a.y,null,!0),this._dispatchMouseEvent(i,"dblclick",!0,-1,a,t)),r&&r._handleDoubleClick(t,e||i&&this)}},{key:"_dispatchMouseEvent",value:function(t,e,i,r,a,n,s){if(t&&(i||t.hasEventListener(e))){var o=new MouseEvent(e,i,(!1),a.x,a.y,n,r,r===this._primaryPointerID||r===-1,a.rawX,a.rawY,s);t.dispatchEvent(o)}}},{key:"nextStage",get:function(){return this._nextStage},set:function(t){this._nextStage&&(this._nextStage._prevStage=null),t&&(t._prevStage=this),this._nextStage=t}}]),e}(Container),StageGL=function(t){function e(t,i){var r=i.preserveBuffer,a=void 0!==r&&r,n=i.antialias,s=void 0!==n&&n,o=i.transparent,h=void 0!==o&&o,l=i.premultiply,u=void 0!==l&&l,c=i.autoPurge,v=void 0===c?1200:c;classCallCheck(this,e);var d=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return d.vocalDebug=!1,d._preserveBuffer=a,d._antialias=s,d._transparent=h,d._premultiply=u,d._autoPurge=v,d._viewportWidth=0,d._viewportHeight=0,d._projectionMatrix=null,d._webGLContext=null,d._clearColor={r:0,g:0,b:0,a:0},d._maxCardsPerBatch=e.DEFAULT_MAX_BATCH_SIZE,d._activeShader=null,d._vertices=null,d._vertexPositionBuffer=null,d._uvs=null,d._uvPositionBuffer=null,d._indices=null,d._textureIndexBuffer=null,d._alphas=null,d._alphaBuffer=null,d._textureDictionary=[],d._textureIDs={},d._batchTextures=[],d._baseTextures=[],d._batchTextureCount=8,d._lastTextureInsert=-1,d._batchID=0,d._drawID=0,d._slotBlacklist=[],d._isDrawing=0,d._lastTrackedCanvas=0,d.isCacheControlled=!1,d._cacheContainer=new Container,d._textureName=0,d._initializeWebGL(),d}return inherits(e,t),createClass(e,[{key:"_initializeWebGL",value:function(){if(this.canvas){if(!this._webGLContext||this._webGLContext.canvas!==this.canvas){var t={depth:!1,alpha:this._transparent,stencil:!0,antialias:this._antialias,premultipliedAlpha:this._premultiply,preserveDrawingBuffer:this._preserveBuffer},e=this._webGLContext=this._fetchWebGLContext(this.canvas,t);if(!e)return null;this.updateSimultaneousTextureCount(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)),this._maxTextureSlots=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._createBuffers(e),this._initTextures(e),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiply),this.setClearColor(),this.updateViewport(this._viewportWidth||this.canvas.width,this._viewportHeight||this.canvas.height)}}else this._webGLContext=null;return this._webGLContext}},{key:"update",value:function(t){if(this.canvas){if(this.tickOnUpdate&&this.tick(t),this.dispatchEvent("drawstart"),this.autoClear&&this.clear(),this._webGLContext)this._batchDraw(this,this._webGLContext),this._autoPurge==-1||this._drawID%(this._autoPurge/2|0)||this.purgeTextures(this._autoPurge);else{var e=this.canvas.getContext("2d");e.save(),this.updateContext(e),this.draw(e,!1),e.restore()}this.dispatchEvent("drawend")}}},{key:"clear",value:function(){if(this.canvas)if(e.isWebGLActive(this._webGLContext)){var t=this._webGLContext;t.clear(t.COLOR_BUFFER_BIT)}else{var i=this.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}}},{key:"draw",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t===this._webGLContext&&e.isWebGLActive(this._webGLContext)){var r=this._webGLContext;return this._batchDraw(this,r,i),!0}return get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i)}},{key:"cacheDraw",value:function(t,i,r){return!!e.isWebGLActive(this._webGLContext)&&(this._cacheDraw(t,i,r),!0)}},{key:"protectTextureSlot",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t>this._maxTextureSlots||t<0)throw"Slot outside of acceptable range";this._slotBlacklist[t]=e}},{key:"getTargetRenderTexture",value:function(t,e,i){var r=void 0,a=!1,n=this._webGLContext;if(void 0!==t.__lastRT&&t.__lastRT===t.__rtA&&(a=!0),a?(void 0===t.__rtB?t.__rtB=this.getRenderBufferTexture(e,i):(e==t.__rtB._width&&i==t.__rtB._height||this.resizeTexture(t.__rtB,e,i),this.setTextureParams(n)),r=t.__rtB):(void 0===t.__rtA?t.__rtA=this.getRenderBufferTexture(e,i):(e==t.__rtA._width&&i==t.__rtA._height||this.resizeTexture(t.__rtA,e,i),this.setTextureParams(n)),r=t.__rtA),!r)throw"Problems creating render textures, known causes include using too much VRAM by not releasing WebGL texture instances";return t.__lastRT=r,r}},{key:"releaseTexture",value:function(t){if(t){if(t.children)for(var e=0,i=t.children.length;e<i;e++)this.releaseTexture(t.children[e]);t.cacheCanvas&&(t.uncache(),this.vocalDebug&&console.log("Automatic uncache call, potentially unexpected behaviour. Recommend manual uncache calling."));var r=void 0;if(void 0!==t._storeID){if(t===this._textureDictionary[t._storeID])return this._killTextureObject(t),void(t._storeID=void 0);r=t}else if(2===t._webGLRenderStyle)r=t.image;else if(1===t._webGLRenderStyle){for(var a=0,n=t.spriteSheet._images.length;a<n;a++)this.releaseTexture(t.spriteSheet._images[a]);return}if(void 0===r)return void(this.vocalDebug&&console.log("No associated texture found on release"));this._killTextureObject(this._textureDictionary[r._storeID]),r._storeID=void 0}}},{key:"purgeTextures",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,e=this._textureDictionary,i=e.length,r=0;r<i;r++){var a=e[r];a&&a._drawID+t<=this._drawID&&this._killTextureObject(a)}}},{key:"updateSimultaneousTextureCount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this._webGLContext,i=!1;for(this._batchTextureCount=t;!i;)try{this._activeShader=this._fetchShaderProgram(e),i=!0}catch(t){if(1==this._batchTextureCount)throw"Cannot compile shader "+t;this._batchTextureCount-=4,this._batchTextureCount<1&&(this._batchTextureCount=1),this.vocalDebug&&console.log("Reducing desired texture count due to errors: "+this._batchTextureCount)}}},{key:"updateViewport",value:function(t,e){this._viewportWidth=0|t,this._viewportHeight=0|e;var i=this._webGLContext;i&&(i.viewport(0,0,this._viewportWidth,this._viewportHeight),this._projectionMatrix=new Float32Array([2/this._viewportWidth,0,0,0,0,-2/this._viewportHeight,1,0,0,0,1,0,-1,1,.1,0]),this._projectionMatrixFlip=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this._projectionMatrixFlip.set(this._projectionMatrix),this._projectionMatrixFlip[5]*=-1,this._projectionMatrixFlip[13]*=-1)}},{key:"getFilterShader",value:function(t){t||(t=this);var e=this._webGLContext,i=this._activeShader;if(t._builtShader)i=t._builtShader,i.shaderParamSetup&&i.shaderParamSetup(e,this,i);else try{i=this._fetchShaderProgram(e,"filter",t.VTX_SHADER_BODY,t.FRAG_SHADER_BODY,t.shaderParamSetup&&t.shaderParamSetup.bind(t)),t._builtShader=i,i._name=t.toString()}catch(t){console&&console.log(t)}return i}},{key:"getBaseTexture",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=Math.ceil(t>0?t:1),r=Math.ceil(e>0?e:1),a=this._webGLContext,n=a.createTexture();return this.resizeTexture(n,i,r),this.setTextureParams(a,!1),n.__trackName=this._textureName++,n}},{key:"resizeTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this._webGLContext;r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,i,0,r.RGBA,r.UNSIGNED_BYTE,null),t.width=e,t.height=i}},{key:"getRenderBufferTexture",value:function(t,e){var i=this._webGLContext,r=this.getBaseTexture(t,e);if(!r)return null;var a=i.createFramebuffer();return r?(r.width=t,r.height=e,i.bindFramebuffer(i.FRAMEBUFFER,a),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,r,0),a._renderTexture=r,r._frameBuffer=a,r._storeID=this._textureDictionary.length,this._textureDictionary[r._storeID]=r,i.bindFramebuffer(i.FRAMEBUFFER,null),r):null}},{key:"setTextureParams",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&this._antialias?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}},{key:"setClearColor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=void 0,i=void 0,r=void 0,a=void 0,n=void 0;"string"==typeof t?0==t.indexOf("#")?(4==t.length&&(t="#"+(t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3))),e=Number("0x"+t.slice(1,3))/255,i=Number("0x"+t.slice(3,5))/255,r=Number("0x"+t.slice(5,7))/255,a=Number("0x"+t.slice(7,9))/255):0==t.indexOf("rgba(")&&(n=t.slice(5,-1).split(","),e=Number(n[0])/255,i=Number(n[1])/255,r=Number(n[2])/255,a=Number(n[3])):(e=((4278190080&t)>>>24)/255,i=((16711680&t)>>>16)/255,r=((65280&t)>>>8)/255,a=(255&t)/255),this._clearColor.r=e||0,this._clearColor.g=i||0,this._clearColor.b=r||0,this._clearColor.a=a||0,this._webGLContext&&this._webGLContext.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a)}},{key:"_fetchWebGLContext",value:function(t,e){var i=void 0;try{i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)}catch(t){}if(i)i.viewportWidth=t.width,i.viewportHeight=t.height;else{var r="Could not initialize WebGL";console.error?console.error(r):console.log(r)}return i}},{key:"_fetchShaderProgram",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular",r=arguments[2],a=arguments[3],n=arguments[4];t.useProgram(null);var s=void 0,o=void 0;switch(i){case"filter":o=e.COVER_VERTEX_HEADER+(r||e.COVER_VERTEX_BODY),s=e.COVER_FRAGMENT_HEADER+(a||e.COVER_FRAGMENT_BODY);break;case"particle":o=e.REGULAR_VERTEX_HEADER+e.PARTICLE_VERTEX_BODY,s=e.REGULAR_FRAGMENT_HEADER+e.PARTICLE_FRAGMENT_BODY;break;case"override":o=e.REGULAR_VERTEX_HEADER+(r||e.REGULAR_VERTEX_BODY),s=e.REGULAR_FRAGMENT_HEADER+(a||e.REGULAR_FRAGMENT_BODY);break;case"regular":default:o=e.REGULAR_VERTEX_HEADER+e.REGULAR_VERTEX_BODY,s=e.REGULAR_FRAGMENT_HEADER+e.REGULAR_FRAGMENT_BODY}var h=this._createShader(t,t.VERTEX_SHADER,o),l=this._createShader(t,t.FRAGMENT_SHADER,s),u=t.createProgram();if(t.attachShader(u,h),t.attachShader(u,l),t.linkProgram(u),u._type=i,!t.getProgramParameter(u,t.LINK_STATUS))throw t.useProgram(this._activeShader),t.getProgramInfoLog(u);switch(t.useProgram(u),i){case"filter":u.vertexPositionAttribute=t.getAttribLocation(u,"vertexPosition"),t.enableVertexAttribArray(u.vertexPositionAttribute),u.uvPositionAttribute=t.getAttribLocation(u,"uvPosition"),t.enableVertexAttribArray(u.uvPositionAttribute),u.samplerUniform=t.getUniformLocation(u,"uSampler"),t.uniform1i(u.samplerUniform,0),u.uprightUniform=t.getUniformLocation(u,"uUpright"),t.uniform1f(u.uprightUniform,0),n&&n(t,this,u);break;case"override":case"particle":case"regular":default:u.vertexPositionAttribute=t.getAttribLocation(u,"vertexPosition"),t.enableVertexAttribArray(u.vertexPositionAttribute),u.uvPositionAttribute=t.getAttribLocation(u,"uvPosition"),t.enableVertexAttribArray(u.uvPositionAttribute),u.textureIndexAttribute=t.getAttribLocation(u,"textureIndex"),t.enableVertexAttribArray(u.textureIndexAttribute),u.alphaAttribute=t.getAttribLocation(u,"objectAlpha"),t.enableVertexAttribArray(u.alphaAttribute);for(var c=[],v=0;v<this._batchTextureCount;v++)c[v]=v;u.samplerData=c,u.samplerUniform=t.getUniformLocation(u,"uSampler"),t.uniform1iv(u.samplerUniform,c),u.pMatrixUniform=t.getUniformLocation(u,"pMatrix")}return t.useProgram(this._activeShader),u}},{key:"_createShader",value:function(t,e,i){i=i.replace(/{{count}}/g,this._batchTextureCount);for(var r="",a=1;a<this._batchTextureCount;a++)r+="} else if (src == "+a+") { color = texture2D(uSampler["+a+"], vTextureCoord);";i=i.replace(/{{alternates}}/g,r).replace(/{{premultiply}}/g,this._premultiply?"/color.a":"");var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw t.getShaderInfoLog(n);return n}},{key:"_createBuffers",value:function(t){var i=this._maxCardsPerBatch*e.INDICIES_PER_CARD,r=void 0,a=this._vertexPositionBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),r=2;for(var n=this._vertices=new Float32Array(i*r),s=0,o=n.length;s<o;s+=r)n[s]=n[s+1]=0;t.bufferData(t.ARRAY_BUFFER,n,t.DYNAMIC_DRAW),a.itemSize=r,a.numItems=i;var h=this._uvPositionBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),r=2;for(var l=this._uvs=new Float32Array(i*r),u=0,c=l.length;u<c;u+=r)l[u]=l[u+1]=0;t.bufferData(t.ARRAY_BUFFER,l,t.DYNAMIC_DRAW),h.itemSize=r,h.numItems=i;var v=this._textureIndexBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,v),r=1;for(var d=this._indices=new Float32Array(i*r),_=0,f=d.length;_<f;_++)d[_]=0;t.bufferData(t.ARRAY_BUFFER,d,t.DYNAMIC_DRAW),v.itemSize=r,v.numItems=i;var p=this._alphaBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,p),r=1;for(var g=this._alphas=new Float32Array(i*r),m=0,y=g.length;m<y;m++)g[m]=1;t.bufferData(t.ARRAY_BUFFER,g,t.DYNAMIC_DRAW),p.itemSize=r,p.numItems=i}},{key:"_initTextures",value:function(){this._lastTextureInsert=-1,this._textureDictionary=[],this._textureIDs={},this._baseTextures=[],this._batchTextures=[];for(var t=0;t<this._batchTextureCount;t++){var e=this.getBaseTexture();if(this._baseTextures[t]=this._batchTextures[t]=e,!e)throw"Problems creating basic textures, known causes include using too much VRAM by not releasing WebGL texture instances"}}},{key:"_loadTextureImage",value:function(t,e){var i=e.src;i||(e._isCanvas=!0,i=e.src="canvas_"+this._lastTrackedCanvas++);var r=this._textureIDs[i];void 0===r&&(r=this._textureIDs[i]=this._textureDictionary.length),void 0===this._textureDictionary[r]&&(this._textureDictionary[r]=this.getBaseTexture());var a=this._textureDictionary[r];if(a)a._batchID=this._batchID,a._storeID=r,a._imageData=e,this._insertTextureInBatch(t,a),e._storeID=r,e.complete||e.naturalWidth||e._isCanvas?this._updateTextureImageData(t,e):e.addEventListener("load",this._updateTextureImageData.bind(this,t,e));else{var n="Problems creating basic textures, known causes include using too much VRAM by not releasing WebGL texture instances";console.error&&console.error(n)||console.log(n),a=this._baseTextures[0],a._batchID=this._batchID,a._storeID=-1,a._imageData=a,this._insertTextureInBatch(t,a)}return a}},{key:"_updateTextureImageData",value:function(t,e){var i=e.width&e.width-1||e.height&e.height-1,r=this._textureDictionary[e._storeID];t.activeTexture(t.TEXTURE0+r._activeIndex),t.bindTexture(t.TEXTURE_2D,r),r.isPOT=!i,this.setTextureParams(t,r.isPOT);try{t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}catch(t){var a="\nAn error has occurred. This is most likely due to security restrictions on WebGL images with local or cross-domain origins";console.error?console.error(t,a):console&&console.log(t,a)}e._invalid=!1,r._w=e.width,r._h=e.height,this.vocalDebug&&(i&&console.warn("NPOT(Non Power of Two) Texture: "+e.src),(e.width>t.MAX_TEXTURE_SIZE||e.height>t.MAX_TEXTURE_SIZE)&&console&&console.error("Oversized Texture: "+e.width+"x"+e.height+" vs "+t.MAX_TEXTURE_SIZE+"max"))}},{key:"_insertTextureInBatch",value:function(t,e){if(this._batchTextures[e._activeIndex]!==e){var i=-1,r=(this._lastTextureInsert+1)%this._batchTextureCount,a=r;do{if(this._batchTextures[a]._batchID!=this._batchID&&!this._slotBlacklist[a]){i=a;break}a=(a+1)%this._batchTextureCount}while(a!==r);i===-1&&(this.batchReason="textureOverflow",this._drawBuffers(t),this.batchCardCount=0,i=r),this._batchTextures[i]=e,e._activeIndex=i;var n=e._imageData;n&&n._invalid&&void 0!==e._drawID?this._updateTextureImageData(t,n):(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,e),this.setTextureParams(t)),this._lastTextureInsert=i}else{var s=e._imageData;void 0!=e._storeID&&s._invalid&&this._updateTextureImageData(t,s)}e._drawID=this._drawID,e._batchID=this._batchID}},{key:"_killTextureObject",value:function(t){if(t){var e=this._webGLContext;if(void 0!==t._storeID&&t._storeID>=0){this._textureDictionary[t._storeID]=void 0;for(var i in this._textureIDs)this._textureIDs[i]==t._storeID&&delete this._textureIDs[i];t._storeID=void 0}void 0!==t._activeIndex&&this._batchTextures[t._activeIndex]===t&&(this._batchTextures[t._activeIndex]=this._baseTextures[t._activeIndex]);try{t._frameBuffer&&e.deleteFramebuffer(t._frameBuffer),t._frameBuffer=void 0}catch(t){this.vocalDebug&&console.log(t)}try{console.log("KILL",t.__trackName),e.deleteTexture(t)}catch(t){this.vocalDebug&&console.log(t)}}}},{key:"_backupBatchTextures",value:function(t,e){var i=this._webGLContext;this._backupTextures||(this._backupTextures=[]),void 0===e&&(e=this._backupTextures);for(var r=0;r<this._batchTextureCount;r++)i.activeTexture(i.TEXTURE0+r),t?this._batchTextures[r]=e[r]:(e[r]=this._batchTextures[r],this._batchTextures[r]=this._baseTextures[r]),i.bindTexture(i.TEXTURE_2D,this._batchTextures[r]),this.setTextureParams(i,this._batchTextures[r].isPOT);t&&e===this._backupTextures&&(this._backupTextures=[])}},{key:"_batchDraw",value:function(t,e,i){this._isDrawing>0&&this._drawBuffers(e),this._isDrawing++,this._drawID++,this.batchCardCount=0,this.depth=0,this._appendToBatchGroup(t,e,new Matrix2D,this.alpha,i),this.batchReason="drawFinish",this._drawBuffers(e),this._isDrawing--}},{key:"_cacheDraw",value:function(t,e,i){var r=this._webGLContext,a=void 0,n=this._activeShader,s=this._slotBlacklist,o=this._maxTextureSlots-1,h=this._viewportWidth,l=this._viewportHeight;this.protectTextureSlot(o,!0);var u=t.getMatrix();u=u.clone(),u.scale(1/i.scale,1/i.scale),u=u.invert(),u.translate(-i.offX/i.scale,-i.offY/i.scale);var c=this._cacheContainer;c.children=[t],c.transformMatrix=u,this._backupBatchTextures(!1);var v=e&&e.length;v?this._drawFilters(t,e,i):this.isCacheControlled?(r.clear(r.COLOR_BUFFER_BIT),this._batchDraw(c,r,!0)):(r.activeTexture(r.TEXTURE0+o),t.cacheCanvas=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),a=t.cacheCanvas,r.bindFramebuffer(r.FRAMEBUFFER,a._frameBuffer),this.updateViewport(i._drawWidth,i._drawHeight),this._projectionMatrix=this._projectionMatrixFlip,r.clear(r.COLOR_BUFFER_BIT),this._batchDraw(c,r,!0),r.bindFramebuffer(r.FRAMEBUFFER,null),this.updateViewport(h,l)),this._backupBatchTextures(!0),this.protectTextureSlot(o,!1),this._activeShader=n,this._slotBlacklist=s}},{key:"_drawFilters",value:function(t,e,i){var r=this._webGLContext,a=void 0,n=this._maxTextureSlots-1,s=this._viewportWidth,o=this._viewportHeight,h=this._cacheContainer,l=e&&e.length;r.activeTexture(r.TEXTURE0+n),a=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),r.bindFramebuffer(r.FRAMEBUFFER,a._frameBuffer),this.updateViewport(i._drawWidth,i._drawHeight),r.clear(r.COLOR_BUFFER_BIT),this._batchDraw(h,r,!0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a),this.setTextureParams(r);for(var u=!1,c=0;c<l;c++){var v=e[c];this._activeShader=this.getFilterShader(v),this._activeShader&&(r.activeTexture(r.TEXTURE0+n),a=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),r.bindFramebuffer(r.FRAMEBUFFER,a._frameBuffer),r.viewport(0,0,i._drawWidth,i._drawHeight),r.clear(r.COLOR_BUFFER_BIT),this._drawCover(r,u),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a),this.setTextureParams(r),l>1&&(u=!u))}this.isCacheControlled?(r.bindFramebuffer(r.FRAMEBUFFER,null),this.updateViewport(s,o),this._activeShader=this.getFilterShader(this),r.clear(r.COLOR_BUFFER_BIT),this._drawCover(r,u)):(u&&(r.activeTexture(r.TEXTURE0+n),a=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),r.bindFramebuffer(r.FRAMEBUFFER,a._frameBuffer),this._activeShader=this.getFilterShader(this),r.viewport(0,0,i._drawWidth,i._drawHeight),r.clear(r.COLOR_BUFFER_BIT),this._drawCover(r,!u)),r.bindFramebuffer(r.FRAMEBUFFER,null),this.updateViewport(s,o),t.cacheCanvas=a)}},{key:"_appendToBatchGroup",value:function(t,i,r,a,n){t._glMtx||(t._glMtx=new Matrix2D);var s=t._glMtx;s.copy(r),t.transformMatrix?s.appendMatrix(t.transformMatrix):s.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY);for(var o=void 0,h=void 0,l=void 0,u=void 0,c=t.numChildren,v=0;v<c;v++){var d=t.children[v];if(d.visible&&a)if(d.cacheCanvas&&!n||!d.children){this.batchCardCount+1>this._maxCardsPerBatch&&(this.batchReason="vertexOverflow",this._drawBuffers(i),this.batchCardCount=0),d._glMtx||(d._glMtx=new Matrix2D);var _=d._glMtx;_.copy(s),d.transformMatrix?_.appendMatrix(d.transformMatrix):_.appendTransform(d.x,d.y,d.scaleX,d.scaleY,d.rotation,d.skewX,d.skewY,d.regX,d.regY);var f=void 0,p=void 0,g=void 0,m=void 0,y=void 0,x=void 0;if(2===d._webGLRenderStyle||d.cacheCanvas&&!n)g=!n&&d.cacheCanvas||d.image;else{if(1!==d._webGLRenderStyle)continue;m=d.spriteSheet.getFrame(d.currentFrame),g=m.image}var b=this._uvs,w=this._vertices,k=this._indices,E=this._alphas;
if(g){if(void 0===g._storeID?(y=this._loadTextureImage(i,g),this._insertTextureInBatch(i,y)):(y=this._textureDictionary[g._storeID],y._batchID!==this._batchID&&this._insertTextureInBatch(i,y)),p=y._activeIndex,2===d._webGLRenderStyle||d.cacheCanvas&&!n)d.sourceRect?(d._uvRect||(d._uvRect={}),x=d.sourceRect,f=d._uvRect,f.t=x.x/g.width,f.l=x.y/g.height,f.b=(x.x+x.width)/g.width,f.r=(x.y+x.height)/g.height,o=0,h=0,l=x.width+o,u=x.height+h):d.cacheCanvas?(x=d.bitmapCache,f=e.UV_RECT,o=x.x,h=x.y,l=x.width+o,u=x.height+h):(f=e.UV_RECT,o=0,h=0,l=g.width+o,u=g.height+h);else if(1===d._webGLRenderStyle){var C=m.rect;f=m.uvRect,f||(f=e.buildUVRects(d.spriteSheet,d.currentFrame,!1)),o=-m.regX,h=-m.regY,l=C.width-m.regX,u=C.height-m.regY}var T=this.batchCardCount*e.INDICIES_PER_CARD,R=2*T;w[R]=o*_.a+h*_.c+_.tx,w[R+1]=o*_.b+h*_.d+_.ty,w[R+2]=o*_.a+u*_.c+_.tx,w[R+3]=o*_.b+u*_.d+_.ty,w[R+4]=l*_.a+h*_.c+_.tx,w[R+5]=l*_.b+h*_.d+_.ty,w[R+6]=w[R+2],w[R+7]=w[R+3],w[R+8]=w[R+4],w[R+9]=w[R+5],w[R+10]=l*_.a+u*_.c+_.tx,w[R+11]=l*_.b+u*_.d+_.ty,b[R]=f.l,b[R+1]=f.t,b[R+2]=f.l,b[R+3]=f.b,b[R+4]=f.r,b[R+5]=f.t,b[R+6]=f.l,b[R+7]=f.b,b[R+8]=f.r,b[R+9]=f.t,b[R+10]=f.r,b[R+11]=f.b,k[T]=k[T+1]=k[T+2]=k[T+3]=k[T+4]=k[T+5]=p,E[T]=E[T+1]=E[T+2]=E[T+3]=E[T+4]=E[T+5]=d.alpha*a,this.batchCardCount++}}else this._appendToBatchGroup(d,i,s,d.alpha*a)}}},{key:"_drawBuffers",value:function(t){if(!(this.batchCardCount<=0)){this.vocalDebug&&console.log("Draw["+this._drawID+":"+this._batchID+"] : "+this.batchReason);var i=this._activeShader,r=this._vertexPositionBuffer,a=this._textureIndexBuffer,n=this._uvPositionBuffer,s=this._alphaBuffer;t.useProgram(i),t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(i.vertexPositionAttribute,r.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._vertices),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(i.textureIndexAttribute,a.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._indices),t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(i.uvPositionAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._uvs),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(i.alphaAttribute,s.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._alphas),t.uniformMatrix4fv(i.pMatrixUniform,t.FALSE,this._projectionMatrix);for(var o=0;o<this._batchTextureCount;o++){var h=this._batchTextures[o];t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,h),this.setTextureParams(t,h.isPOT)}t.drawArrays(t.TRIANGLES,0,this.batchCardCount*e.INDICIES_PER_CARD),this._batchID++}}},{key:"_drawCover",value:function(t,i){this._isDrawing>0&&this._drawBuffers(t),this.vocalDebug&&console.log("Draw["+this._drawID+":"+this._batchID+"] : Cover");var r=this._activeShader,a=this._vertexPositionBuffer,n=this._uvPositionBuffer;t.clear(t.COLOR_BUFFER_BIT),t.useProgram(r),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(r.vertexPositionAttribute,a.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,e.COVER_VERT),t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(r.uvPositionAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,i?e.COVER_UV_FLIP:e.COVER_UV),t.uniform1i(r.samplerUniform,0),t.uniform1f(r.uprightUniform,i?0:1),t.drawArrays(t.TRIANGLES,0,e.INDICIES_PER_CARD)}},{key:"isWebGL",get:function(){return!!this._webGLContext}},{key:"autoPurge",get:function(){return Number(this._autoPurge)},set:function(t){t=isNaN(t)?1200:t,t!=-1&&t<10&&(t=10),this._autoPurge=t}}],[{key:"buildUVRects",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||!t._frames)return null;for(var a=i!=-1&&r?i:0,n=i!=-1&&r?i+1:t._frames.length,s=a;s<n;s++){var o=t._frames[s];if(!(o.uvRect||o.image.width<=0||o.image.height<=0)){var h=o.rect;o.uvRect={t:h.y/o.image.height,l:h.x/o.image.width,b:(h.y+h.height)/o.image.height,r:(h.x+h.width)/o.image.width}}}return t._frames[i!=-1?i:0].uvRect||e.UV_RECT}},{key:"isWebGLActive",value:function(t){return t&&t instanceof WebGLRenderingContext&&"undefined"!=typeof WebGLRenderingContext}}]),e}(Stage);StageGL.VERTEX_PROPERTY_COUNT=6,StageGL.INDICIES_PER_CARD=6,StageGL.DEFAULT_MAX_BATCH_SIZE=1e4,StageGL.WEBGL_MAX_INDEX_NUM=Math.pow(2,16),StageGL.UV_RECT={t:0,l:0,b:1,r:1},StageGL.COVER_VERT=new Float32Array([-1,1,1,1,-1,-1,1,1,1,-1,-1,-1]),StageGL.COVER_UV=new Float32Array([0,0,1,0,0,1,1,0,1,1,0,1]),StageGL.COVER_UV_FLIP=new Float32Array([0,1,1,1,0,0,1,1,1,0,0,0]),StageGL.REGULAR_VARYING_HEADER="\n\t\tprecision mediump float;\n\t\tvarying vec2 vTextureCoord;\n\t\tvarying lowp float indexPicker;\n\t\tvarying lowp float alphaValue;\n\t",StageGL.REGULAR_VERTEX_HEADER="\n\t\t"+StageGL.REGULAR_VARYING_HEADER+"\n\t\tattribute vec2 vertexPosition;\n\t\tattribute vec2 uvPosition;\n\t\tattribute lowp float textureIndex;\n\t\tattribute lowp float objectAlpha;\n\t\tuniform mat4 pMatrix;\n\t",StageGL.REGULAR_FRAGMENT_HEADER="\n\t\t"+StageGL.REGULAR_VARYING_HEADER+"\n\t\tuniform sampler2D uSampler[{{count}}];\n\t",StageGL.REGULAR_VERTEX_BODY="\n\t\tvoid main (void) {\n\t\t\t// DHG TODO: This doesn't work. Must be something wrong with the hand built matrix see js... bypass for now\n\t\t\t// vertexPosition, round if flag\n\t\t\t// gl_Position = pMatrix * vec4(vertexPosition.x, vertexPosition.y, 0.0, 1.0);\n\t\t\tgl_Position = vec4(\n\t\t\t\t(vertexPosition.x * pMatrix[0][0]) + pMatrix[3][0],\n\t\t\t\t(vertexPosition.y * pMatrix[1][1]) + pMatrix[3][1],\n\t\t\t\tpMatrix[3][2],\n\t\t\t\t1.0\n\t\t\t);\n\t\t\talphaValue = objectAlpha;\n\t\t\tindexPicker = textureIndex;\n\t\t\tvTextureCoord = uvPosition;\n\t\t}\n\t",StageGL.REGULAR_FRAGMENT_BODY="\n\t\tvoid main (void) {\n\t\t\tint src = int(indexPicker);\n\t\t\tvec4 color = vec4(1.0, 0.0, 0.0, 1.0);\n\n\t\t\tif (src == 0) {\n\t\t\t\tcolor = texture2D(uSampler[0], vTextureCoord);\n\t\t\t\t{{alternates}}\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4(color.rgb{{premultiply}}, color.a * alphaValue);\n\t\t}\n\t",StageGL.PARTICLE_VERTEX_BODY="\n\t\t"+StageGL.REGULAR_VERTEX_BODY+"\n\t",StageGL.PARTICLE_FRAGMENT_BODY="\n\t\t"+StageGL.REGULAR_FRAGMENT_BODY+"\n\t",StageGL.COVER_VARYING_HEADER="\n\t\tprecision mediump float;\n\t\tvarying highp vec2 vRenderCoord;\n\t\tvarying highp vec2 vTextureCoord;\n\t",StageGL.COVER_VERTEX_HEADER="\n\t\t"+StageGL.COVER_VARYING_HEADER+"\n\t\tattribute vec2 vertexPosition;\n\t\tattribute vec2 uvPosition;\n\t\tuniform float uUpright;\n\t",StageGL.COVER_FRAGMENT_HEADER="\n\t\t"+StageGL.COVER_VARYING_HEADER+"\n\t\tuniform sampler2D uSampler;\n\t",StageGL.COVER_VERTEX_BODY="\n\t\tvoid main (void) {\n\t\t\tgl_Position = vec4(vertexPosition.x, vertexPosition.y, 0.0, 1.0);\n\t\t\tvRenderCoord = uvPosition;\n\t\t\tvTextureCoord = vec2(uvPosition.x, abs(uUpright - uvPosition.y));\n\t\t}\n\t",StageGL.COVER_FRAGMENT_BODY="\n\t\tvoid main (void) {\n\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\t\t\tgl_FragColor = color;\n\t\t}\n\t",function(){var t=[Sprite,Bitmap];t.forEach(function(t,e){t.prototype._webGLRenderStyle=e+1});var e=BitmapCache.prototype;e._updateSurfaceBASE=e._updateSurface,e._updateSurface=function(){if(!this._options)return void this._updateSurfaceBASE();if(!this._webGLCache)if(this._options===!0||this.target.stage!==this._options)this.target.cacheCanvas=document.createElement("canvas"),this._webGLCache=new StageGL(this.target.cacheCanvas,{}),this._webGLCache.isCacheControlled=!0;else try{this.target.cacheCanvas=!0,this._webGLCache=this._options}catch(t){throw"Invalid StageGL object used for cache param"}var t=this._webGLCache,e=this.target.cacheCanvas;t.isCacheControlled&&(e.width=this._drawWidth,e.height=this._drawHeight,t.updateViewport(this._drawWidth,this._drawHeight)),this.target.filters?(t.getTargetRenderTexture(this.target,this._drawWidth,this._drawHeight),t.getTargetRenderTexture(this.target,this._drawWidth,this._drawHeight)):t.isCacheControlled||t.getTargetRenderTexture(this.target,this._drawWidth,this._drawHeight)},e._drawToCacheBASE=e._drawToCache,e._drawToCache=function(t){var e=this.target.cacheCanvas,i=this.target,r=this._webGLCache;return r?(this._webGLCache.cacheDraw(i,i.filters,this),e=this.target.cacheCanvas,e.width=this._drawWidth,e.height=this._drawHeight,void(e._invalid=!0)):(this._drawToCacheBASE(t),void(e._invalid=!0))},e.releaseBASE=e.release,e.release=function(){if(this._webGLCache)this._webGLCache.isCacheControlled||(this.__lastRT&&(this.__lastRT=void 0),this.__rtA&&this._webGLCache._killTextureObject(this.__rtA),this.__rtB&&this._webGLCache._killTextureObject(this.__rtB),this.target&&this.target.cacheCanvas&&this._webGLCache._killTextureObject(this.target.cacheCanvas)),this._webGLCache=!1;else{var t=this.target.stage;t instanceof StageGL&&(t.releaseTexture(this.target.cacheCanvas),this.target.cacheCanvas.remove())}this.releaseBASE()}}();var _H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1},_V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},Text=function(t){function e(t,i,r){classCallCheck(this,e);var a=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.text=t,a.font=i,a.color=r,a.textAlign="left",a.textBaseline="top",a.maxWidth=null,a.outline=0,a.lineHeight=0,a.lineWidth=null,a}return inherits(e,t),createClass(e,[{key:"isVisible",value:function(){var t=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)}},{key:"draw",value:function(t,i){if(get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t,i))return!0;var r=this.color||"#000";return this.outline?(t.strokeStyle=r,t.lineWidth=1*this.outline):t.fillStyle=r,this._drawText(this._prepContext(t)),!0}},{key:"getMeasuredWidth",value:function(){return this._getMeasuredWidth(this.text)}},{key:"getMeasuredLineHeight",value:function(){return 1.2*this._getMeasuredWidth("M")}},{key:"getMeasuredHeight",value:function(){return this._drawText(null,{}).height}},{key:"getBounds",value:function(){var t=get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getBounds",this).call(this);if(t)return t;if(null==this.text||""===this.text)return null;var i=this._drawText(null,{}),r=this.maxWidth&&this.maxWidth<i.width?this.maxWidth:i.width,a=r*e.H_OFFSETS[this.textAlign||"left"],n=this.lineHeight||this.getMeasuredLineHeight(),s=n*e.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.setValues(a,s,r,i.height)}},{key:"getMetrics",value:function(){var t={lines:[]};return t.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),t.vOffset=t.lineHeight*e.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,t,t.lines)}},{key:"clone",value:function(){return this._cloneProps(new e(this.text,this.font,this.color))}},{key:"toString",value:function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"}},{key:"_cloneProps",value:function(t){return get$1(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_cloneProps",this).call(this,t),t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.maxWidth=this.maxWidth,t.outline=this.outline,t.lineHeight=this.lineHeight,t.lineWidth=this.lineWidth,t}},{key:"_prepContext",value:function(t){return t.font=this.font||"10px sans-serif",t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"top",t}},{key:"_drawText",value:function(t,i,r){var a=!!t;a||(t=e._workingContext,t.save(),this._prepContext(t));var n=this.lineHeight||this.getMeasuredLineHeight(),s=0,o=0,h=String(this.text).split(/(?:\r\n|\r|\n)/),l=!0,u=!1,c=void 0;try{for(var v,d=h[Symbol.iterator]();!(l=(v=d.next()).done);l=!0){var _=v.value,f=null;if(null!=this.lineWidth&&(f=t.measureText(_).width)>this.lineWidth){var p=_.split(/(\s)/);_=p[0],f=t.measureText(_).width;for(var g=p.length,m=1;m<g;m+=2){var y=t.measureText(p[m]+p[m+1]).width;f+y>this.lineWidth?(a&&this._drawTextLine(t,_,o*n),r&&r.push(_),f>s&&(s=f),_=p[m+1],f=t.measureText(_).width,o++):(_+=p[m]+p[m+1],f+=y)}}a&&this._drawTextLine(t,_,o*n),r&&r.push(_),i&&null==f&&(f=t.measureText(_).width),f>s&&(s=f),o++}}catch(t){u=!0,c=t}finally{try{!l&&d.return&&d.return()}finally{if(u)throw c}}return i&&(i.width=s,i.height=o*n),a||t.restore(),i}},{key:"_drawTextLine",value:function(t,e,i){this.outline?t.strokeText(e,0,i,this.maxWidth||65535):t.fillText(e,0,i,this.maxWidth||65535)}},{key:"_getMeasuredWidth",value:function(t){var i=e._workingContext;i.save();var r=this._prepContext(i).measureText(t).width;return i.restore(),r}}],[{key:"H_OFFSETS",get:function(){return _H_OFFSETS}},{key:"V_OFFSETS",get:function(){return _V_OFFSETS}}]),e}(DisplayObject),canvas$2=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");canvas$2.getContext&&(Text._workingContext=canvas$2.getContext("2d"),canvas$2.width=canvas$2.height=1);var AlphaMapFilter=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.alphaMap=t,i._alphaMap=null,i._mapData=null,i._mapTexture=null,i.FRAG_SHADER_BODY="\n\t\t\tuniform sampler2D uAlphaSampler;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\t\t\t\tvec4 alphaMap = texture2D(uAlphaSampler, vTextureCoord);\n\n\t\t\t\t// some image formats can have transparent white rgba(1,1,1, 0) when put on the GPU, this means we need a slight tweak\n\t\t\t\t// using ceil ensure that the colour will be used so long as it exists but pure transparency will be treated black\n\t\t\t\tgl_FragColor = vec4(color.rgb, color.a * (alphaMap.r * ceil(alphaMap.a)));\n\t\t\t}\n\t\t",i}return inherits(e,t),createClass(e,[{key:"shaderParamSetup",value:function(t,e,i){this._mapTexture||(this._mapTexture=t.createTexture()),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._mapTexture),e.setTextureParams(t),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.alphaMap),t.uniform1i(t.getUniformLocation(i,"uAlphaSampler"),1)}},{key:"clone",value:function(){var t=new e(this.alphaMap);return t._alphaMap=this._alphaMap,t._mapData=this._mapData,t}},{key:"_applyFilter",value:function(t){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;for(var e=t.data,i=this._mapData,r=e.length,a=0;a<r;a+=4)e[a+3]=i[a]||0;return!0}},{key:"_prepAlphaMap",value:function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var t=this._alphaMap=this.alphaMap,e=t,i=void 0;t instanceof HTMLCanvasElement?i=e.getContext("2d"):(e=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),e.width=t.width,e.height=t.height,i=e.getContext("2d"),i.drawImage(t,0,0));try{return this._mapData=i.getImageData(0,0,t.width,t.height).data,!0}catch(t){return!1}}}]),e}(Filter),AlphaMaskFilter=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.mask=t,i.FRAG_SHADER_BODY="\n\t\t\tuniform sampler2D uAlphaSampler;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\t\t\t\tvec4 alphaMap = texture2D(uAlphaSampler, vTextureCoord);\n\n\t\t\t\tgl_FragColor = vec4(color.rgb, color.a * alphaMap.a);\n\t\t\t}\n\t\t",i}return inherits(e,t),createClass(e,[{key:"applyFilter",value:function(t,e,i,r,a,n,s,o){return!this.mask||(n=n||t,null==s&&(s=e),null==o&&(o=i),n.save(),t==n&&(n.globalCompositeOperation="destination-in",n.drawImage(this.mask,s,o),n.restore(),!0))}},{key:"clone",value:function(){return new e(this.mask)}},{key:"shaderParamSetup",value:function(t,e,i){this._mapTexture||(this._mapTexture=t.createTexture()),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._mapTexture),e.setTextureParams(t),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.mask),t.uniform1i(t.getUniformLocation(i,"uAlphaSampler"),1)}}]),e}(Filter),_MUL_TABLE=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],_SHG_TABLE=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],BlurFilter=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;classCallCheck(this,e);var a=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._blurX=t,a._blurXTable=[],a._blurY=i,a._blurYTable=[],a._quality,a.FRAG_SHADER_TEMPLATE="\n\t\t\tuniform float xWeight[{{blurX}}];\n\t\t\tuniform float yWeight[{{blurY}}];\n\t\t\tuniform vec2 textureOffset;\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = vec4(0.0);\n\n\t\t\t\tfloat xAdj = ({{blurX}}.0-1.0)/2.0;\n\t\t\t\tfloat yAdj = ({{blurY}}.0-1.0)/2.0;\n\t\t\t\tvec2 sampleOffset;\n\n\t\t\t\tfor(int i=0; i<{{blurX}}; i++) {\n\t\t\t\t\tfor(int j=0; j<{{blurY}}; j++) {\n\t\t\t\t\t\tsampleOffset = vRenderCoord + (textureOffset * vec2(float(i)-xAdj, float(j)-yAdj));\n\t\t\t\t\t\tcolor += texture2D(uSampler, sampleOffset) * (xWeight[i] * yWeight[j]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = color.rgba;\n\t\t\t}\n\t\t",a.quality=isNaN(r)||r<1?1:r,a}return inherits(e,t),createClass(e,[{key:"updateShader",value:function(){var t=this.FRAG_SHADER_TEMPLATE;t=t.replace(/{{blurX}}/g,this._blurXTable.length.toFixed(0)),t=t.replace(/{{blurY}}/g,this._blurYTable.length.toFixed(0)),this.FRAG_SHADER_BODY=t}},{key:"shaderParamSetup",value:function(t,e,i){t.uniform1fv(t.getUniformLocation(i,"xWeight"),this._blurXTable),t.uniform1fv(t.getUniformLocation(i,"yWeight"),this._blurYTable),t.uniform2f(t.getUniformLocation(i,"textureOffset"),2/(e._viewportWidth*this._quality),2/(e._viewportHeight*this._quality))}},{key:"getBounds",value:function(t){var e=0|this.blurX,i=0|this.blurY;if(e<=0&&i<=0)return t;var r=Math.pow(this.quality,.2);return(t||new Rectangle).pad(e*r+1,i*r+1,e*r+1,i*r+1)}},{key:"clone",value:function(){return new e(this.blurX,this.blurY,this.quality)}},{key:"_getTable",value:function(t){var e=4.2;if(t<=1)return[1];var i=[],r=Math.ceil(2*t);r+=r%2?0:1;for(var a=r/2|0,n=-a;n<=a;n++){var s=n/a*e;i.push(1/Math.sqrt(2*Math.PI)*Math.pow(Math.E,-(Math.pow(s,2)/4)))}var o=i.reduce(function(t,e){return t+e},0);return i.map(function(t){return t/o})}},{key:"_applyFilter",value:function(t){var i=this._blurX>>1;if(isNaN(i)||i<0)return!1;var r=this._blurY>>1;if(isNaN(r)||r<0)return!1;if(0==i&&0==r)return!1;var a=this.quality;(isNaN(a)||a<1)&&(a=1),a|=0,a>3&&(a=3),a<1&&(a=1);var n=t.data,s=0,o=0,h=0,l=0,u=0,c=0,v=0,d=0,_=0,f=0,p=0,g=0,m=0,y=0,x=0,b=i+i+1|0,w=r+r+1|0,k=0|t.width,E=0|t.height,C=k-1|0,T=E-1|0,R=i+1|0,S=r+1|0,D={r:0,b:0,g:0,a:0},A=D;for(h=1;h<b;h++)A=A.n={r:0,b:0,g:0,a:0};A.n=D;var P={r:0,b:0,g:0,a:0},M=P;for(h=1;h<w;h++)M=M.n={r:0,b:0,g:0,a:0};M.n=P;for(var I=null,O=0|e.MUL_TABLE[i],L=0|e.SHG_TABLE[i],F=0|e.MUL_TABLE[r],B=0|e.SHG_TABLE[r];a-- >0;){v=c=0;var G=O,U=L;for(o=E;--o>-1;){for(d=R*(g=n[0|c]),_=R*(m=n[c+1|0]),f=R*(y=n[c+2|0]),p=R*(x=n[c+3|0]),A=D,h=R;--h>-1;)A.r=g,A.g=m,A.b=y,A.a=x,A=A.n;for(h=1;h<R;h++)l=c+((C<h?C:h)<<2)|0,d+=A.r=n[l],_+=A.g=n[l+1],f+=A.b=n[l+2],p+=A.a=n[l+3],A=A.n;for(I=D,s=0;s<k;s++)n[c++]=d*G>>>U,n[c++]=_*G>>>U,n[c++]=f*G>>>U,n[c++]=p*G>>>U,l=v+((l=s+i+1)<C?l:C)<<2,d-=I.r-(I.r=n[l]),_-=I.g-(I.g=n[l+1]),f-=I.b-(I.b=n[l+2]),p-=I.a-(I.a=n[l+3]),I=I.n;v+=k}for(G=F,U=B,s=0;s<k;s++){for(c=s<<2|0,d=S*(g=n[c])|0,_=S*(m=n[c+1|0])|0,f=S*(y=n[c+2|0])|0,p=S*(x=n[c+3|0])|0,M=P,h=0;h<S;h++)M.r=g,M.g=m,M.b=y,M.a=x,M=M.n;for(u=k,h=1;h<=r;h++)c=u+s<<2,d+=M.r=n[c],_+=M.g=n[c+1],f+=M.b=n[c+2],p+=M.a=n[c+3],M=M.n,h<T&&(u+=k);if(c=s,I=P,a>0)for(o=0;o<E;o++)l=c<<2,n[l+3]=x=p*G>>>U,x>0?(n[l]=d*G>>>U,n[l+1]=_*G>>>U,n[l+2]=f*G>>>U):n[l]=n[l+1]=n[l+2]=0,l=s+((l=o+S)<T?l:T)*k<<2,d-=I.r-(I.r=n[l]),_-=I.g-(I.g=n[l+1]),f-=I.b-(I.b=n[l+2]),p-=I.a-(I.a=n[l+3]),I=I.n,c+=k;else for(o=0;o<E;o++)l=c<<2,n[l+3]=x=p*G>>>U,x>0?(x=255/x,n[l]=(d*G>>>U)*x,n[l+1]=(_*G>>>U)*x,n[l+2]=(f*G>>>U)*x):n[l]=n[l+1]=n[l+2]=0,l=s+((l=o+S)<T?l:T)*k<<2,d-=I.r-(I.r=n[l]),_-=I.g-(I.g=n[l+1]),f-=I.b-(I.b=n[l+2]),p-=I.a-(I.a=n[l+3]),I=I.n,c+=k}}return!0}},{key:"blurX",get:function(){return this._blurX},set:function(t){(isNaN(t)||t<0)&&(t=0),this._blurX=t,this._blurXTable=this._getTable(t*this._quality),this.updateShader()}},{key:"blurY",get:function(){return this._blurY},set:function(t){(isNaN(t)||t<0)&&(t=0),this._blurY=t,this._blurYTable=this._getTable(t*this._quality),this.updateShader()}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this._blurXTable=this._getTable(this._blurX*this._quality),this._blurYTable=this._getTable(this._blurY*this._quality),this.updateShader()}}],[{key:"MUL_TABLE",get:function(){return _MUL_TABLE}},{key:"SHG_TABLE",get:function(){return _SHG_TABLE}}]),e}(Filter),ColorFilter=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;classCallCheck(this,e);var l=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return l.redMultiplier=t,l.greenMultiplier=i,l.blueMultiplier=r,l.alphaMultiplier=a,l.redOffset=n,l.greenOffset=s,l.blueOffset=o,l.alphaOffset=h,l.FRAG_SHADER_BODY="\n\t\t\tuniform vec4 uColorMultiplier;\n\t\t\tuniform vec4 uColorOffset;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\n\t\t\t\tgl_FragColor = (color * uColorMultiplier) + uColorOffset;\n\t\t\t}\n\t\t",l}return inherits(e,t),createClass(e,[{key:"shaderParamSetup",value:function(t,e,i){t.uniform4f(t.getUniformLocation(i,"uColorMultiplier"),this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier),t.uniform4f(t.getUniformLocation(i,"uColorOffset"),this.redOffset/255,this.greenOffset/255,this.blueOffset/255,this.alphaOffset/255)}},{key:"clone",value:function(){return new e(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)}},{key:"_applyFilter",value:function(t){for(var e=t.data,i=e.length,r=0;r<i;r+=4)e[r]=e[r]*this.redMultiplier+this.redOffset,e[r+1]=e[r+1]*this.greenMultiplier+this.greenOffset,e[r+2]=e[r+2]*this.blueMultiplier+this.blueOffset,e[r+3]=e[r+3]*this.alphaMultiplier+this.alphaOffset;return!0}}]),e}(Filter),_DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],_IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],_LENGTH=25,ColorMatrix=function(){function t(e,i,r,a){classCallCheck(this,t),this.setColor(e,i,r,a)}return createClass(t,[{key:"setColor",value:function(t,e,i,r){return this.reset().adjustColor(t,e,i,r)}},{key:"reset",value:function(){return this.copy(t.IDENTITY_MATRIX)}},{key:"adjustColor",value:function(t,e,i,r){return this.adjustHue(r),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)}},{key:"adjustBrightness",value:function(t){return 0==t||isNaN(t)?this:(t=this._cleanValue(t,255),this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1]),this)}},{key:"adjustContrast",value:function(e){if(0==e||isNaN(e))return this;e=this._cleanValue(e,100);var i=void 0;return e<0?i=127+e/100*127:(i=e%1,i=0==i?t.DELTA_INDEX[e]:t.DELTA_INDEX[e<<0]*(1-i)+t.DELTA_INDEX[(e<<0)+1]*i,i=127*i+127),this._multiplyMatrix([i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1]),this}},{key:"adjustSaturation",value:function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,100);var e=1+(t>0?3*t/100:t/100),i=.3086,r=.6094,a=.082;return this._multiplyMatrix([i*(1-e)+e,r*(1-e),a*(1-e),0,0,i*(1-e),r*(1-e)+e,a*(1-e),0,0,i*(1-e),r*(1-e),a*(1-e)+e,0,0,0,0,0,1,0,0,0,0,0,1]),this}},{key:"adjustHue",value:function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,180)/180*Math.PI;var e=Math.cos(t),i=Math.sin(t),r=.213,a=.715,n=.072;return this._multiplyMatrix([r+e*(1-r)+i*-r,a+e*-a+i*-a,n+e*-n+i*(1-n),0,0,r+e*-r+.143*i,a+e*(1-a)+.14*i,n+e*-n+i*-.283,0,0,r+e*-r+i*-(1-r),a+e*-a+i*a,n+e*(1-n)+i*n,0,0,0,0,0,1,0,0,0,0,0,1]),this}},{key:"concat",value:function(e){return e=this._fixMatrix(e),e.length!=t.LENGTH?this:(this._multiplyMatrix(e),this)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"toArray",value:function(){for(var e=[],i=t.LENGTH,r=0;r<i;r++)e[r]=this[r];return e}},{key:"copy",value:function(e){for(var i=t.LENGTH,r=0;r<i;r++)this[r]=e[r];return this}},{key:"toString",value:function(){return"[ColorMatrix]"}},{key:"_multiplyMatrix",value:function(t){for(var e=[],i=0;i<5;i++){for(var r=0;r<5;r++)e[r]=this[r+5*i];for(var a=0;a<5;a++){for(var n=0,s=0;s<5;s++)n+=t[a+5*s]*e[s];this[a+5*i]=n}}}},{key:"_cleanValue",value:function(t,e){return Math.min(e,Math.max(-e,t))}},{key:"_fixMatrix",value:function(e){return e instanceof t&&(e=e.toArray()),e.length<t.LENGTH?e=e.slice(0,e.length).concat(t.IDENTITY_MATRIX.slice(e.length,t.LENGTH)):e.length>t.LENGTH&&(e=e.slice(0,t.LENGTH)),e}}],[{key:"DELTA_INDEX",get:function(){return _DELTA_INDEX}},{key:"IDENTITY_MATRIX",get:function(){return _IDENTITY_MATRIX}},{key:"LENGTH",get:function(){return _LENGTH}}]),t}(),ColorMatrixFilter=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.matrix=t,i.FRAG_SHADER_BODY="\n\t\t\tuniform mat4 uColorMatrix;\n\t\t\tuniform vec4 uColorMatrixOffset;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\n\t\t\t\tmat4 m = uColorMatrix;\n\t\t\t\tvec4 newColor = vec4(0,0,0,0);\n\t\t\t\tnewColor.r = color.r*m[0][0] + color.g*m[0][1] + color.b*m[0][2] + color.a*m[0][3];\n\t\t\t\tnewColor.g = color.r*m[1][0] + color.g*m[1][1] + color.b*m[1][2] + color.a*m[1][3];\n\t\t\t\tnewColor.b = color.r*m[2][0] + color.g*m[2][1] + color.b*m[2][2] + color.a*m[2][3];\n\t\t\t\tnewColor.a = color.r*m[3][0] + color.g*m[3][1] + color.b*m[3][2] + color.a*m[3][3];\n\n\t\t\t\tgl_FragColor = newColor + uColorMatrixOffset;\n\t\t\t}\n\t\t",i}return inherits(e,t),createClass(e,[{key:"shaderParamSetup",value:function(t,e,i){var r=this.matrix,a=new Float32Array([r[0],r[1],r[2],r[3],r[5],r[6],r[7],r[8],r[10],r[11],r[12],r[13],r[15],r[16],r[17],r[18]]);t.uniformMatrix4fv(t.getUniformLocation(i,"uColorMatrix"),!1,a),t.uniform4f(t.getUniformLocation(i,"uColorMatrixOffset"),r[4]/255,r[9]/255,r[14]/255,r[19]/255)}},{key:"clone",value:function(){return new e(this.matrix)}},{key:"_applyFilter",value:function(t){for(var e=t.data,i=e.length,r=void 0,a=void 0,n=void 0,s=void 0,o=this.matrix,h=o[0],l=o[1],u=o[2],c=o[3],v=o[4],d=o[5],_=o[6],f=o[7],p=o[8],g=o[9],m=o[10],y=o[11],x=o[12],b=o[13],w=o[14],k=o[15],E=o[16],C=o[17],T=o[18],R=o[19],S=0;S<i;S+=4)r=e[S],a=e[S+1],n=e[S+2],s=e[S+3],e[S]=r*h+a*l+n*u+s*c+v,e[S+1]=r*d+a*_+n*f+s*p+g,e[S+2]=r*m+a*y+n*x+s*b+w,e[S+3]=r*k+a*E+n*C+s*T+R;return!0}}]),e}(Filter),ButtonHelper=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"out",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"over",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"down",n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments[5],o=arguments[6];classCallCheck(this,t),e.addEventListener&&(this.target=e,this.overLabel=r,this.outLabel=i,this.downLabel=null==a,this.play=n,this._isPressed=!1,this._isOver=!1,this._enabled=!1,e.mouseChildren=!1,this.enabled=!0,this.handleEvent({}),s&&(o&&(s.actionsEnabled=!1,s.gotoAndStop&&s.gotoAndStop(o)),e.hitArea=s))}return createClass(t,[{key:"toString",value:function(){return"[ButtonHelper]"}},{key:"handleEvent",value:function(t){var e=void 0,i=this.target,r=t.type;"mousedown"==r?(this._isPressed=!0,e=this.downLabel):"pressup"==r?(this._isPressed=!1,e=this._isOver?this.overLabel:this.outLabel):"rollover"==r?(this._isOver=!0,e=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,e=this._isPressed?this.overLabel:this.outLabel),this.play?i.gotoAndPlay&&i.gotoAndPlay(e):i.gotoAndStop&&i.gotoAndStop(e)}},{key:"_reset",value:function(){var t=this.paused;this.__reset(),this.paused=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(t!=this._enabled){var e=this.target;this._enabled=t,t?(e.cursor="pointer",e.addEventListener("rollover",this),e.addEventListener("rollout",this),e.addEventListener("mousedown",this),e.addEventListener("pressup",this),e._reset&&(e.__reset=e._reset,e._reset=this._reset)):(e.cursor=null,e.removeEventListener("rollover",this),e.removeEventListener("rollout",this),e.removeEventListener("mousedown",this),e.removeEventListener("pressup",this),e.__reset&&(e._reset=e.__reset,delete e.__reset))}}}]),t}(),Touch=function(){function t(){throw classCallCheck(this,t),"Touch cannot be instantiated"}return createClass(t,null,[{key:"isSupported",value:function(){return!!("ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)}},{key:"enable",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!(e&&e.canvas&&t.isSupported())&&(!!e.__touch||(e.__touch={pointers:{},multitouch:!i,preventDefault:!r,count:0},"ontouchstart"in window?t._IOS_enable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_enable(e),!0))}},{key:"disable",value:function(e){e&&("ontouchstart"in window?t._IOS_disable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_disable(e),delete e.__touch)}},{key:"_IOS_enable",value:function(e){var i=e.canvas,r=e.__touch.f=function(i){return t._IOS_handleEvent(e,i)};i.addEventListener("touchstart",r,!1),i.addEventListener("touchmove",r,!1),
i.addEventListener("touchend",r,!1),i.addEventListener("touchcancel",r,!1)}},{key:"_IOS_disable",value:function(t){var e=t.canvas;if(e){var i=t.__touch.f;e.removeEventListener("touchstart",i,!1),e.removeEventListener("touchmove",i,!1),e.removeEventListener("touchend",i,!1),e.removeEventListener("touchcancel",i,!1)}}},{key:"_IOS_handleEvent",value:function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();var i=e.changedTouches,r=e.type,a=(i.length,!0),n=!1,s=void 0;try{for(var o,h=i[Symbol.iterator]();!(a=(o=h.next()).done);a=!0){var l=o.value,u=l.identifier;l.target==t.canvas&&("touchstart"==r?this._handleStart(t,u,e,l.pageX,l.pageY):"touchmove"==r?this._handleMove(t,u,e,l.pageX,l.pageY):"touchend"!=r&&"touchcancel"!=r||this._handleEnd(t,u,e))}}catch(t){n=!0,s=t}finally{try{!a&&h.return&&h.return()}finally{if(n)throw s}}}}},{key:"_IE_enable",value:function(e){var i=e.canvas,r=e.__touch.f=function(i){return t._IE_handleEvent(e,i)};void 0===window.navigator.pointerEnabled?(i.addEventListener("MSPointerDown",r,!1),window.addEventListener("MSPointerMove",r,!1),window.addEventListener("MSPointerUp",r,!1),window.addEventListener("MSPointerCancel",r,!1),e.__touch.preventDefault&&(i.style.msTouchAction="none")):(i.addEventListener("pointerdown",r,!1),window.addEventListener("pointermove",r,!1),window.addEventListener("pointerup",r,!1),window.addEventListener("pointercancel",r,!1),e.__touch.preventDefault&&(i.style.touchAction="none")),e.__touch.activeIDs={}}},{key:"_IE_disable",value:function(t){var e=t.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",e,!1),window.removeEventListener("MSPointerUp",e,!1),window.removeEventListener("MSPointerCancel",e,!1),t.canvas&&t.canvas.removeEventListener("MSPointerDown",e,!1)):(window.removeEventListener("pointermove",e,!1),window.removeEventListener("pointerup",e,!1),window.removeEventListener("pointercancel",e,!1),t.canvas&&t.canvas.removeEventListener("pointerdown",e,!1))}},{key:"_IE_handleEvent",value:function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();var i=e.type,r=e.pointerId,a=t.__touch.activeIDs;if("MSPointerDown"==i||"pointerdown"==i){if(e.srcElement!=t.canvas)return;a[r]=!0,this._handleStart(t,r,e,e.pageX,e.pageY)}else a[r]&&("MSPointerMove"==i||"pointermove"==i?this._handleMove(t,r,e,e.pageX,e.pageY):"MSPointerUp"!=i&&"MSPointerCancel"!=i&&"pointerup"!=i&&"pointercancel"!=i||(delete a[r],this._handleEnd(t,r,e)))}}},{key:"_handleStart",value:function(t,e,i,r,a){var n=t.__touch;if(n.multitouch||!n.count){var s=n.pointers;s[e]||(s[e]=!0,n.count++,t._handlePointerDown(e,i,r,a))}}},{key:"_handleMove",value:function(t,e,i,r,a){t.__touch.pointers[e]&&t._handlePointerMove(e,i,r,a)}},{key:"_handleEnd",value:function(t,e,i){var r=t.__touch,a=r.pointers;a[e]&&(r.count--,t._handlePointerUp(e,i,!0),delete a[e])}}]),t}(),_ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",_ERR_RUNNING="a build is already running",SpriteSheetBuilder=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.maxWidth=2048,i.maxHeight=2048,i.spriteSheet=null,i.scale=1,i.padding=1,i.timeSlice=.3,i.progress=-1,i.framerate=t,i._frames=[],i._animations={},i._data=null,i._nextFrameIndex=0,i._index=0,i._timerID=null,i._scale=1,i}return inherits(e,t),createClass(e,[{key:"addFrame",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments[3],n=arguments[4];if(this._data)throw e.ERR_RUNNING;var s=i||t.bounds||t.nominalBounds||t.getBounds&&t.getBounds();return s?this._frames.push({source:t,sourceRect:s,scale:r,funct:a,data:n,index:this._frames.length,height:s.height*r})-1:null}},{key:"addAnimation",value:function(t,i,r,a){if(this._data)throw e.ERR_RUNNING;this._animations[t]={frames:i,next:r,speed:a}}},{key:"addMovieClip",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments[3],n=arguments[4],s=arguments[5];if(this._data)throw e.ERR_RUNNING;var o=t.frameBounds,h=i||t.bounds||t.nominalBounds||t.getBounds&&t.getBounds();if(h||o){for(var l=this._frames.length,u=t.timeline.duration,c=0;c<u;c++){var v=o&&o[c]?o[c]:h;this.addFrame(t,v,r,this._setupMovieClipFrame,{i:c,f:a,d:n})}var d=t.timeline._labels,_=[];for(var f in d)_.push({index:d[f],label:f});if(_.length){_.sort(function(t,e){return t.index-e.index});for(var p=0,g=_.length;p<g;p++){for(var m=_[p].label,y=l+_[p].index,x=l+(p==g-1?u:_[p+1].index),b=[],w=y;w<x;w++)b.push(w);s&&!(m=s(m,t,y,x))||this.addAnimation(m,b,!0)}}}}},{key:"build",value:function(){if(this._data)throw e.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet}},{key:"buildAsync",value:function(t){var i=this;if(this._data)throw e.ERR_RUNNING;this.timeSlice=t,this._startBuild(),this._timerID=setTimeout(function(){return i._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))}},{key:"stopAsync",value:function(){clearTimeout(this._timerID),this._data=null}},{key:"clone",value:function(){throw"SpriteSheetBuilder cannot be cloned."}},{key:"toString",value:function(){return"[SpriteSheetBuilder]"}},{key:"_startBuild",value:function(){var t=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var i=[];this._data={images:[],frames:i,framerate:this.framerate,animations:this._animations};var r=this._frames.slice();if(r.sort(function(t,e){return t.height<=e.height?-1:1}),r[r.length-1].height+2*t>this.maxHeight)throw e.ERR_DIMENSIONS;for(var a=0,n=0,s=0;r.length;){var o=this._fillRow(r,a,s,i,t);if(o.w>n&&(n=o.w),a+=o.h,!o.h||!r.length){var h=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");h.width=this._getSize(n,this.maxWidth),h.height=this._getSize(a,this.maxHeight),this._data.images[s]=h,o.h||(n=a=0,s++)}}}},{key:"_setupMovieClipFrame",value:function(t,e){var i=t.actionsEnabled;t.actionsEnabled=!1,t.gotoAndStop(e.i),t.actionsEnabled=i,e.f&&e.f(t,e.d,e.i)}},{key:"_getSize",value:function(t,e){for(var i=4;Math.pow(2,++i)<t;);return Math.min(e,Math.pow(2,i))}},{key:"_fillRow",value:function(t,i,r,a,n){var s=this.maxWidth,o=this.maxHeight;i+=n;for(var h=o-i,l=n,u=0,c=t.length-1;c>=0;c--){var v=t[c],d=this._scale*v.scale,_=v.sourceRect,f=v.source,p=Math.floor(d*_.x-n),g=Math.floor(d*_.y-n),m=Math.ceil(d*_.height+2*n),y=Math.ceil(d*_.width+2*n);if(y>s)throw e.ERR_DIMENSIONS;m>h||l+y>s||(v.img=r,v.rect=new Rectangle(l,i,y,m),u=u||m,t.splice(c,1),a[v.index]=[l,i,y,m,r,Math.round(-p+d*f.regX-n),Math.round(-g+d*f.regY-n)],l+=y)}return{w:l,h:u}}},{key:"_endBuild",value:function(){this.spriteSheet=new SpriteSheet(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")}},{key:"_run",value:function(){for(var t=this,e=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),i=(new Date).getTime()+e,r=!1;i>(new Date).getTime();)if(!this._drawNext()){r=!0;break}r?this._endBuild():this._timerID=setTimeout(function(){return t._run()},50-e);var a=this.progress=this._index/this._frames.length;if(this.hasEventListener("progress")){var n=new Event("progress");n.progress=a,this.dispatchEvent(n)}}},{key:"_drawNext",value:function(){var t=this._frames[this._index],e=t.scale*this._scale,i=t.rect,r=t.sourceRect,a=this._data.images[t.img],n=a.getContext("2d");return t.funct&&t.funct(t.source,t.data),n.save(),n.beginPath(),n.rect(i.x,i.y,i.width,i.height),n.clip(),n.translate(Math.ceil(i.x-r.x*e),Math.ceil(i.y-r.y*e)),n.scale(e,e),t.source.draw(n),n.restore(),++this._index<this._frames.length}}],[{key:"ERR_DIMENSIONS",get:function(){return _ERR_DIMENSIONS}},{key:"ERR_RUNNING",get:function(){return _ERR_RUNNING}}]),e}(EventDispatcher),SpriteSheetUtils=function(){function t(){throw classCallCheck(this,t),"SpriteSheetUtils cannot be instantiated"}return createClass(t,null,[{key:"extractFrame",value:function(e,i){isNaN(i)&&(i=e.getAnimation(i).frames[0]);var r=e.getFrame(i);if(!r)return null;var a=r.rect,n=t._workingCanvas;n.width=a.width,n.height=a.height,t._workingContext.drawImage(r.image,a.x,a.y,a.width,a.height,0,0,a.width,a.height);var s=document.createElement("img");return s.src=n.toDataURL("image/png"),s}},{key:"mergeAlpha",value:function(t,e,i){i||(i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),i.width=Math.max(e.width,t.width),i.height=Math.max(e.height,t.height);var r=i.getContext("2d");return r.save(),r.drawImage(t,0,0),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),r.restore(),i}},{key:"_flip",value:function(e,i,r,a){for(var n=e._images,s=t._workingCanvas,o=t._workingContext,h=n.length/i,l=0;l<h;l++){var u=n[l];u.__tmp=l,o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,s.width+1,s.height+1),s.width=u.width,s.height=u.height,o.setTransform(r?-1:1,0,0,a?-1:1,r?u.width:0,a?u.height:0),o.drawImage(u,0,0);var c=document.createElement("img");c.src=s.toDataURL("image/png"),c.width=u.width,c.height=u.height,n.push(c)}for(var v=e._frames,d=v.length/i,_=0;_<d;_++){var f=v[_],p=f.rect.clone(),g=n[f.image.__tmp+h*i],m={image:g,rect:p,regX:f.regX,regY:f.regY};r&&(p.x=g.width-p.x-p.width,m.regX=p.width-f.regX),a&&(p.y=g.height-p.y-p.height,m.regY=p.height-f.regY),v.push(m)}for(var y="_"+(r?"h":"")+(a?"v":""),x=e._animations,b=e._data,w=x.length/i,k=0;k<w;k++){var E=x[k],C=b[E],T={name:E+y,speed:C.speed,next:C.next,frames:[]};C.next&&(T.next+=y);for(var R=C.frames,S=0,D=R.length;S<D;S++)T.frames.push(R[S]+d*i);b[T.name]=T,x.push(T.name)}}}]),t}(),canvas$3=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");canvas$3.getContext&&(SpriteSheetUtils._workingCanvas=canvas$3,SpriteSheetUtils._workingContext=canvas$3.getContext("2d"),canvas$3.width=canvas$3.height=1);var _alternateOutput=null,WebGLInspector=function(t){function e(t){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._stage=t,i}return inherits(e,t),createClass(e,[{key:"log",value:function(t){t||(t=this._stage),e._log("Batches Per Draw: "+(t._batchID/t._drawID).toFixed(4)),this.logContextInfo(t._webGLContext),this.logDepth(t.children,""),this.logTextureFill(t)}},{key:"toggleGPUDraw",value:function(t,i){t||(t=this._stage),void 0===i&&(i=!!t._drawBuffers_),i&&t._drawBuffers_?(t._drawBuffers=t._drawBuffers_,t._drawBuffers_=void 0):(t._drawBuffers_=t._drawBuffers,t._drawBuffers=function(t){this.vocalDebug&&e._log("BlankDraw["+this._drawID+":"+this._batchID+"] : "+this.batchReason)})}},{key:"logDepth",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e._log;t||(t=this._stage.children);for(var a=t.length,n=0;n<a;n++){var s=t[n];r(i+"-",s),s.children&&s.children.length&&this.logDepth(s.children,"|"+i,r)}}},{key:"logContextInfo",value:function(t){t||(t=this._stage._webGLContext);var i="\n\t\t\t== LOG:\n\n\t\t\tMax textures per draw: "+t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)+"\n\n\t\t\tMax textures active: "+t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)+"\n\n\t\t\t\n\n\t\t\tMax texture size: "+t.getParameter(t.MAX_TEXTURE_SIZE)/2+"\n\n\t\t\tMax cache size: "+t.getParameter(t.MAX_RENDERBUFFER_SIZE)/2+"\n\n\t\t\t\n\n\t\t\tMax attributes per vertex: "+t.getParameter(t.MAX_VERTEX_ATTRIBS)+"\n\n\t\t\tWebGL Version string: "+t.getParameter(t.VERSION)+"\n\n\t\t\t======\n\t\t";e._log(i)}},{key:"logTextureFill",value:function(t){t||(t=this._stage);var i=t._textureDictionary,r=t._batchTextureCount;e._log(textureMax+": "+r);var a=[];for(var n in i){var s=(n.replace(window.location.origin,""),i[n]),o=!!s._lastActiveIndex&&s._lastActiveIndex==s._activeIndex;a.push({src:src,element:s,shifted:o}),s._lastActiveIndex=s._activeIndex}a.sort(function(e,i){return e.element._drawID==t._drawID?1:e.element._drawID<i.element._drawID?-1:0});for(var h=a.length,l=0;l<h;l++){var u=a[l],c=u.element._drawID==t._drawID;e._log("["+u.src+"] "+(c?"ACTIVE":"stale")+" "+(u.shifted?"steady":"DRIFT"),u.element)}}}],[{key:"dispProps",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="\tP: "+t.x.toFixed(2)+"x"+t.y.toFixed(2)+"\t",a="\tR: "+t.regX.toFixed(2)+"x"+t.regY.toFixed(2)+"\t";e._log(i,t.toString()+"\t",r,a)}},{key:"_log",value:function(){if(e.alternateOutput){var t;(t=e.alternateOutput).log.apply(t,arguments)}else{var i;(i=console).log.apply(i,arguments)}}},{key:"alternateOutput",get:function(){return _alternateOutput},set:function(t){_alternateOutput=t}}]),e}(EventDispatcher);exports.DisplayObject=DisplayObject,exports.Container=Container,exports.Bitmap=Bitmap,exports.BitmapText=BitmapText,exports.DOMElement=DOMElement,exports.Graphics=Graphics,exports.Arc=Arc,exports.ArcTo=ArcTo,exports.BeginPath=BeginPath,exports.BezierCurveTo=BezierCurveTo,exports.Circle=Circle,exports.ClosePath=ClosePath,exports.Ellipse=Ellipse,exports.Fill=Fill,exports.LineTo=LineTo,exports.MoveTo=MoveTo,exports.PolyStar=PolyStar,exports.QuadraticCurveTo=QuadraticCurveTo,exports.Rect=Rect,exports.RoundRect=RoundRect,exports.Stroke=Stroke,exports.StrokeDash=StrokeDash,exports.StrokeStyle=StrokeStyle,exports.MovieClip=MovieClip,exports.Shadow=Shadow$1,exports.Shape=Shape,exports.Sprite=Sprite,exports.SpriteSheet=SpriteSheet,exports.Stage=Stage,exports.StageGL=StageGL,exports.Text=Text,exports.MouseEvent=MouseEvent,exports.AlphaMapFilter=AlphaMapFilter,exports.AlphaMaskFilter=AlphaMaskFilter,exports.BitmapCache=BitmapCache,exports.BlurFilter=BlurFilter,exports.ColorFilter=ColorFilter,exports.ColorMatrix=ColorMatrix,exports.ColorMatrixFilter=ColorMatrixFilter,exports.Filter=Filter,exports.DisplayProps=DisplayProps,exports.Matrix2D=Matrix2D,exports.Point=Point,exports.Rectangle=Rectangle,exports.ButtonHelper=ButtonHelper,exports.Touch=Touch,exports.SpriteSheetBuilder=SpriteSheetBuilder,exports.SpriteSheetUtils=SpriteSheetUtils,exports.UID=UID,exports.WebGLInspector=WebGLInspector;