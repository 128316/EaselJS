	<!DOCTYPE html>
	<html>
	<head>
	<title>EaselJS Example: Transform</title>

	<link href="../_assets/css/shared.css" rel="stylesheet" type="text/css"/>
	<link href="../_assets/css/examples.css" rel="stylesheet" type="text/css"/>

	<script type="text/javascript" src="../lib/easeljs-NEXT.combined.js"></script>
	<!-- We also provide hosted minified versions of all CreateJS libraries. http://code.createjs.com -->
	<script src="../_assets/js/Slider.js"></script>

	<script type="text/javascript">
		var stage;
		var canvas;
		var imageContainer;
		var totalWidth;
		var slideWidth;
		var totalHeight;


		function init() {
			if (window.top != window) {
				document.getElementById("header").style.display = "none";
			}
			document.getElementById("loader").className = "loader";

			canvas = document.getElementById('testCanvas');
			stage = new createjs.Stage(canvas);

			imageContainer = new createjs.Container();
			stage.enableMouseOver (10);

			var slider = new Slider(-30, 30, 200, 50).set({x:canvas.width-200, y:0});
			slider.on("change", handleSliderChange, this);

			var robotImage = new Image();
			robotImage.src = "../_assets/art/robot.png";
			robotImage.onload = handleImageLoad;
			stage.addChild(slider);
			createjs.Ticker.addEventListener("tick", tick);
		}

		function handleImageLoad() {
			var total = 4;
			totalWidth = this.width | 0;
			totalHeight = this.height | 0;
			slideWidth = totalWidth/total;
			var rect;
			for(var i=0;i<total;i++) {
				var bmp = new createjs.Bitmap(this);
				rect = new createjs.Rectangle(slideWidth*i | 0, 0,slideWidth,totalHeight);
				bmp.sourceRect = rect;
				bmp.cache(0,0, slideWidth, totalHeight);
				bmp.x = slideWidth*i | 0;
				bmp.snapToPixel = true;
				imageContainer.addChild(bmp);
			}
			imageContainer.regX = totalWidth>>1;
			imageContainer.regY = totalHeight>>1;
			centerImage();

			stage.addChild(imageContainer);
		}

		function stop() {
			createjs.Ticker.removeEventListener("tick", tick);
		}

		function show(value) {

		}

		function transformImage(value) {
			if (value == 0) { return; }
			var l = imageContainer.getNumChildren();
			for(var i=0;i<l;i++) {
				var bmp = imageContainer.getChildAt(i);
				if (i%2) {
					bmp.skewY = value;
				} else {
					bmp.skewY = -value;
					bmp.y = -(slideWidth) *Math.sin(bmp.skewY/180*Math.PI)
				}
				bmp.x = ((slideWidth)*i) * Math.cos(bmp.skewY/180*Math.PI);
				bmp.filters = [getColorMatrixFilter(bmp.skewY)];
				bmp.updateCache();
			}

			var _scale = (value > 0) ? 1/value * 15 : -1*(1/value * 15);
			imageContainer.rotation = (value > 0) ? value>>1 : - 1*value>>1;
			imageContainer.scaleX = imageContainer.scaleY = (_scale <= 1)?_scale : 1;
			centerImage();
		}

		function centerImage() {
			imageContainer.x = (totalWidth) + canvas.width
					- totalWidth>> 1;
			imageContainer.y = (totalHeight) + canvas.height -
					totalHeight >> 1;
		}

		function getColorMatrixFilter(value) {
			var cm = new createjs.ColorMatrix();
			cm.adjustBrightness(value*0.85);
			return new createjs.ColorMatrixFilter(cm);
		}

		function handleSliderChange(event) {
			var target = event.target;
			transformImage(target.value);
		}

		function tick(event) {
			stage.update(event);
		}

		function touchstart(event) {
			if (event.target.localName != "select") {
				event.preventDefault();
			}

		}

	</script>
	<link rel="stylesheet" href="assets/demoStyles.css"/>

</head>
<body onload="init()" ontouchstart="touchstart(this)" style="-webkit-tap-highlight-color: rgba(0,0,0,0);">
	<div id="loader"></div>
	<header id="header" class="EaselJS">
		<h1>Transformation</h1>
		<p>This sample shows transformations, including skews. Drag the slider to affect the skew amount.</p>
	</header>
	<canvas id="testCanvas" width="960" height="400" style="background-color:
	 #000000"></canvas>
</body>
</html>
